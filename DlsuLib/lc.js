//limit length of an input
function limitQLength(obj, length, msg){
	var maxlength=length;
	if (obj.value.length>maxlength) { obj.value=obj.value.substring(0, maxlength); 
		alert(msg);
	}
}

//used to change bg color of form elements on focus/blur
function bgC(el,color){
	if (!color) { var color = '#FFEFCF';}
	el.style.backgroundColor = color;
}

//hit function
function hit(id,table,src) {

	jQuery.post(
		'/recordhit.php?id='+id+'&table='+table+'&src='+src,
		function (){}
	);
	return false;

}

//displays long list of calendars
function hideLongList(){
	jQuery('.hideLongList').each(function(index) {
		jQuery(this).removeClass('hideLongList');
	});
	jQuery('#showAllL').hide();
	return false;
}

//Homepage functions
function browseOrg(event_org) {
	jQuery('#browse').html(event_org+'</div>');
	loadBrowse('browse_org');
	return false;
}

function browseCal(bycal) {
	jQuery('#browse').html(bycal+'</div>');
	loadBrowse('browse_cal');
	return false;
}

function loadBrowse(mode) {
	jQuery('#browsec').html('<br/><p style="text-align: center"><img src="/images/loading_lg.gif" alt="Loading" /></p>');
	jQuery.post(
		'/process_view.php?mode='+mode+'&cal_id=0',
		function (data) {
			jQuery('#browsec').hide().html(data).fadeIn('fast');				
		}
	);			
	return false;
}
//profile page
function jumpToProfile(v) {
	window.location.href="/profile.php?uid="+v;
	return false;
}

//Changes label/disabled of buttons to "working"/off status
function disableButton(btnid, text) {
	if (typeof text == 'undefined') { text = ''; }
	if (text == '') {
		jQuery('#'+btnid).prop('disabled', true);
	} else {
		jQuery('#'+btnid).html(text).prop('disabled', true);
	}
}

//reenables buttons
function enableButton(btnid, text) {
	if (typeof text == 'undefined') { text = ''; }
	if (text == '') {
		jQuery('#'+btnid).prop('disabled', false);
	} else {
		jQuery('#'+btnid).html(text).prop('disabled', false);
	}
}

function closeDialog(id) {
	if (typeof id == 'undefined') { id = 'dialog'; }
	jQuery("#"+id).dialog('close');
	jQuery("#"+id).remove();
	return false;
}

//jquery ajax dialog
function ajaxDialog (url, querystring, ttle, wdth) {
	var dialog = jQuery("#dialog");
	    if (jQuery("#dialog").length == 0) {
	        dialog = jQuery('<div id="dialog" style="display:hidden"></div>').appendTo('body');
	    } 
        dialog.load(
            url, 
            querystring + "&nocache=" + (new Date()).getTime(),
            function (responseText, textStatus, XMLHttpRequest) {
                dialog.dialog({
                	title: ttle,
                	width: wdth,
					modal: true,
                	close: function(event, ui) { jQuery(this).remove(); }
		        });
            }
        );
	return false;
}

//none ajax modal
function modalWindow(text, title, width){
	if (typeof title == 'undefined') { var title='Alert'; }
	if (typeof width == 'undefined') { var width='600px'; }
	
	var dialog = jQuery("#dialog");
    if (jQuery("#dialog").length == 0) {
        dialog = jQuery('<div id="dialog" style="display:hidden"></div>').appendTo('body');
    }
    dialog.html(text);
    dialog.dialog({title: title, width: width, modal: true});
    return false;
}

/*
 * jQuery Notification
 * Copyright 2011 Cory LaViska for A Beautiful Site, LLC. (http://abeautifulsite.net/)
 * Dual licensed under the MIT or GPL Version 2 licenses
 * Packed to save space.
 */
(function($){$.notification=function(message,settings){if(message===''||message===undefined||message===null)return;settings=$.extend(true,{className:'jquery-notification',duration:2000,freezeOnHover:true,hideSpeed:200,position:'center',showSpeed:150,zIndex:99999},settings);if($('#jquery-notification').length>0)settings.showSpeed=0;$('#jquery-notification').remove();var width,height,top,left,windowWidth=$(window).width(),windowHeight=$(window).height(),timeout,notification=$('<div id="jquery-notification" />');function hide(){clearTimeout(timeout);notification.fadeOut(settings.hideSpeed,function(){$(this).remove()})}notification.appendTo($('BODY')).addClass(settings.className).html(message).css({position:'fixed',display:'none',zIndex:settings.zIndex}).mouseover(function(){if(settings.freezeOnHover)clearTimeout(timeout);$(this).addClass(settings.className+'-hover')}).mouseout(function(){$(this).removeClass(settings.className+'-hover');if(settings.freezeOnHover){timeout=setTimeout(hide,settings.duration)}}).click(hide).wrapInner('<div id="jquery-notification-message" />');width=notification.outerWidth();height=notification.outerHeight();switch(settings.position){case'top':top=0;left=windowWidth/2-width/2;break;case'top-left':top=0;left=0;break;case'top-right':top=0;left=windowWidth-width;break;case'bottom':top=windowHeight-height;left=windowWidth/2-width/2;break;case'bottom-left':top=windowHeight-height;left=0;break;case'bottom-right':top=windowHeight-height;left=windowWidth-width;break;case'left':top=windowHeight/2-height/2;left=0;break;case'right':top=windowHeight/2-height/2;left=windowWidth-width;break;default:case'center':top=windowHeight/2-height/2;left=windowWidth/2-width/2;break}notification.css({top:top,left:left}).fadeIn(settings.showSpeed,function(){timeout=setTimeout(hide,settings.duration)})}})(jQuery);

function errorAlert(msg){
	if (typeof msg == 'undefined' || msg == '') { msg = 'Error: Please try again.'; }
	jQuery.notification(msg, { className: 'jquery-notification-error', duration: 5000 });
}

function successAlert(msg){
	if (typeof msg == 'undefined' || msg == '') { msg = 'Success.'; }
	jQuery.notification(msg);
}

function workingAlert(msg){
	if (typeof msg == 'undefined' || msg == '') { msg = ' <img src="/images/ajax-loader.gif"> '; }
	jQuery.notification(msg);
}
function stopAlert(){
	jQuery('#jquery-notification').hide();
}

/*
 * jQuery MultiSelect UI Widget 1.13
 * Copyright (c) 2012 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery 1.4.2+
 *   - jQuery UI 1.8 widget factory
 *
 * Optional:
 *   - jQuery UI effects
 *   - jQuery UI position utility
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
(function(d){var k=0;d.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:!1,multiple:!0,position:{}},_create:function(){var a=this.element.hide(),b=this.options;this.speed=d.fx.speeds._default;this._isOpen=!1;a=(this.button=d('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(b.classes).attr({title:a.attr("title"),"aria-haspopup":!0,tabIndex:a.attr("tabIndex")}).insertAfter(a);(this.buttonlabel=d("<span />")).html(b.noneSelectedText).appendTo(a);var a=(this.menu=d("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(b.classes).appendTo(document.body),c=(this.header=d("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(a);(this.headerLinkContainer=d("<ul />")).addClass("ui-helper-reset").html(function(){return!0===b.header?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+b.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+b.uncheckAllText+"</span></a></li>":"string"===typeof b.header?"<li>"+b.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(c);(this.checkboxContainer=d("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(a);this._bindEvents();this.refresh(!0);b.multiple||a.addClass("ui-multiselect-single")},_init:function(){!1===this.options.header&&this.header.hide();this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide();this.options.autoOpen&&this.open();this.element.is(":disabled")&&this.disable()},refresh:function(a){var b=this.element,c=this.options,f=this.menu,h=this.checkboxContainer,g=[],e="",i=b.attr("id")||k++;b.find("option").each(function(b){d(this);var a=this.parentNode,f=this.innerHTML,h=this.title,k=this.value,b="ui-multiselect-"+(this.id||i+"-option-"+b),l=this.disabled,n=this.selected,m=["ui-corner-all"],o=(l?"ui-multiselect-disabled ":" ")+this.className,j;"OPTGROUP"===a.tagName&&(j=a.getAttribute("label"),-1===d.inArray(j,g)&&(e+='<li class="ui-multiselect-optgroup-label '+a.className+'"><a href="#">'+j+"</a></li>",g.push(j)));l&&m.push("ui-state-disabled");n&&!c.multiple&&m.push("ui-state-active");e+='<li class="'+o+'">';e+='<label for="'+b+'" title="'+h+'" class="'+m.join(" ")+'">';e+='<input id="'+b+'" name="multiselect_'+i+'" type="'+(c.multiple?"checkbox":"radio")+'" value="'+k+'" title="'+f+'"';n&&(e+=' checked="checked"',e+=' aria-selected="true"');l&&(e+=' disabled="disabled"',e+=' aria-disabled="true"');e+=" /><span>"+f+"</span></label></li>"});h.html(e);this.labels=f.find("label");this.inputs=this.labels.children("input");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();a||this._trigger("refresh")},update:function(){var a=this.options,b=this.inputs,c=b.filter(":checked"),f=c.length,a=0===f?a.noneSelectedText:d.isFunction(a.selectedText)?a.selectedText.call(this,f,b.length,c.get()):/\d/.test(a.selectedList)&&0<a.selectedList&&f<=a.selectedList?c.map(function(){return d(this).next().html()}).get().join(", "):a.selectedText.replace("#",f).replace("#",b.length);this.buttonlabel.html(a);return a},_bindEvents:function(){function a(){b[b._isOpen? "close":"open"]();return!1}var b=this,c=this.button;c.find("span").bind("click.multiselect",a);c.bind({click:a,keypress:function(a){switch(a.which){case 27:case 38:case 37:b.close();break;case 39:case 40:b.open()}},mouseenter:function(){c.hasClass("ui-state-disabled")||d(this).addClass("ui-state-hover")},mouseleave:function(){d(this).removeClass("ui-state-hover")},focus:function(){c.hasClass("ui-state-disabled")||d(this).addClass("ui-state-focus")},blur:function(){d(this).removeClass("ui-state-focus")}});this.header.delegate("a","click.multiselect",function(a){if(d(this).hasClass("ui-multiselect-close"))b.close();else b[d(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]();a.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(a){a.preventDefault();var c=d(this),g=c.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),e=g.get(),c=c.parent().text();!1!==b._trigger("beforeoptgrouptoggle",a,{inputs:e,label:c})&&(b._toggleChecked(g.filter(":checked").length!==g.length,g),b._trigger("optgrouptoggle",a,{inputs:e,label:c,checked:e[0].checked}))}).delegate("label","mouseenter.multiselect",function(){d(this).hasClass("ui-state-disabled")||(b.labels.removeClass("ui-state-hover"),d(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(a){a.preventDefault();switch(a.which){case 9:case 27:b.close();break;case 38:case 40:case 37:case 39:b._traverse(a.which,this);break;case 13:d(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(a){var c=d(this),g=this.value,e=this.checked,i=b.element.find("option");this.disabled||!1===b._trigger("click",a,{value:g,text:this.title,checked:e})?a.preventDefault():(c.focus(),c.attr("aria-selected",e),i.each(function(){this.value===g?this.selected=e:b.options.multiple||(this.selected=!1)}),b.options.multiple||(b.labels.removeClass("ui-state-active"),c.closest("label").toggleClass("ui-state-active",e),b.close()),b.element.trigger("change"),setTimeout(d.proxy(b.update,b),10))});d(document).bind("mousedown.multiselect",function(a){b._isOpen&&(!d.contains(b.menu[0],a.target)&&!d.contains(b.button[0],a.target)&&a.target!==b.button[0])&&b.close()});d(this.element[0].form).bind("reset.multiselect",function(){setTimeout(d.proxy(b.refresh,b),10)})},_setButtonWidth:function(){var a=this.element.outerWidth(),b=this.options;/\d/.test(b.minWidth)&&a<b.minWidth&&(a=b.minWidth);this.button.width(a)},_setMenuWidth:function(){var a=this.menu,b=this.button.outerWidth()-parseInt(a.css("padding-left"),10)-parseInt(a.css("padding-right"),10)-parseInt(a.css("border-right-width"),10)-parseInt(a.css("border-left-width"),10);a.width(b||this.button.outerWidth())},_traverse:function(a,b){var c=d(b),f=38===a||37===a,c=c.parent()[f?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[f?"last":"first"]();c.length?c.find("label").trigger("mouseover"):(c=this.menu.find("ul").last(),this.menu.find("label")[f? "last":"first"]().trigger("mouseover"),c.scrollTop(f?c.height():0))},_toggleState:function(a,b){return function(){this.disabled||(this[a]=b);b?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(a,b){var c=b&&b.length?b:this.inputs,f=this;c.each(this._toggleState("checked",a));c.eq(0).focus();this.update();var h=c.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&-1<d.inArray(this.value,h)&&f._toggleState("selected",a).call(this)});c.length&&this.element.trigger("change")},_toggleDisabled:function(a){this.button.attr({disabled:a,"aria-disabled":a})[a?"addClass":"removeClass"]("ui-state-disabled");var b=this.menu.find("input"),b=a?b.filter(":enabled").data("ech-multiselect-disabled",!0):b.filter(function(){return!0===d.data(this,"ech-multiselect-disabled")}).removeData("ech-multiselect-disabled");b.attr({disabled:a,"arial-disabled":a}).parent()[a?"addClass":"removeClass"]("ui-state-disabled");this.element.attr({disabled:a,"aria-disabled":a})},open:function(){var a=this.button,b=this.menu,c=this.speed,f=this.options,h=[];if(!(!1===this._trigger("beforeopen")||a.hasClass("ui-state-disabled")||this._isOpen)){var g=b.find("ul").last(),e=f.show,i=a.offset();d.isArray(f.show)&&(e=f.show[0],c=f.show[1]||this.speed);e&&(h=[e,c]);g.scrollTop(0).height(f.height);d.ui.position&&!d.isEmptyObject(f.position)?(f.position.of=f.position.of||a,b.show().position(f.position).hide()):b.css({top:i.top+a.outerHeight(),left:i.left});d.fn.show.apply(b,h);this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");a.addClass("ui-state-active");this._isOpen=!0;this._trigger("open")}},close:function(){if(!1!==this._trigger("beforeclose")){var a=this.options,b=a.hide,c=this.speed,f=[];d.isArray(a.hide)&&(b=a.hide[0],c=a.hide[1]||this.speed);b&&(f=[b,c]);d.fn.hide.apply(this.menu,f);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this._isOpen=!1;this._trigger("close")}},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(){this._toggleChecked(!0);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){d.Widget.prototype.destroy.call(this);this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},_setOption:function(a,b){var c=this.menu;switch(a){case "header":c.find("div.ui-multiselect-header")[b?"show":"hide"]();break;case "checkAllText":c.find("a.ui-multiselect-all span").eq(-1).text(b);break;case "uncheckAllText":c.find("a.ui-multiselect-none span").eq(-1).text(b);break;case "height":c.find("ul").last().height(parseInt(b,10));break;case "minWidth":this.options[a]=parseInt(b,10);this._setButtonWidth();this._setMenuWidth();break;case "selectedText":case "selectedList":case "noneSelectedText":this.options[a]=b;this.update();break;case "classes":c.add(this.button).removeClass(this.options.classes).addClass(b);break;case "multiple":c.toggleClass("ui-multiselect-single",!b),this.options.multiple=b,this.element[0].multiple=b,this.refresh()}d.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);

/*
 * jQuery MultiSelect UI Widget Filtering Plugin 1.4
 * Copyright (c) 2011 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery UI MultiSelect widget
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
*/
(function(a){var f=/[\-\[\]{}()*+?.,\\\^$|#\s]/g;a.widget("ech.multiselectfilter",{options:{label:"Filter:",width:null,placeholder:"Enter keywords",autoReset:!1},_create:function(){var e;var b=this,c=this.options,d=this.instance=a(this.element).data("multiselect");this.header=d.menu.find(".ui-multiselect-header").addClass("ui-multiselect-hasfilter");e=this.wrapper=a('<div class="ui-multiselect-filter">'+(c.label.length?c.label:"")+'<input placeholder="'+c.placeholder+'" type="search"'+(/\d/.test(c.width)?  'style="width:'+c.width+'px"':"")+" /></div>").prependTo(this.header),c=e;this.inputs=d.menu.find('input[type="checkbox"], input[type="radio"]');this.input=c.find("input").bind({keydown:function(a){13===a.which&&a.preventDefault()},keyup:a.proxy(b._handler,b),click:a.proxy(b._handler,b)});this.updateCache();d._toggleChecked=function(c,d){var e=d&&d.length?d:this.labels.find("input"),i=this,e=e.not(b.instance._isOpen?":disabled, :hidden":":disabled").each(this._toggleState("checked",c));this.update(); var j=e.map(function(){return this.value}).get();this.element.find("option").filter(function(){!this.disabled&&-1<a.inArray(this.value,j)&&i._toggleState("selected",c).call(this)})};d=a(document).bind("multiselectrefresh",function(){b.updateCache();b._handler()});this.options.autoReset&&d.bind("multiselectclose",a.proxy(this._reset,this))},_handler:function(b){var c=a.trim(this.input[0].value.toLowerCase()),d=this.rows,g=this.inputs,h=this.cache;if(c){d.hide();var e=RegExp(c.replace(f,"\\$&"),"gi"); this._trigger("filter",b,a.map(h,function(a,b){return-1!==a.search(e)?(d.eq(b).show(),g.get(b)):null}))}else d.show();this.instance.menu.find(".ui-multiselect-optgroup-label").each(function(){var b=a(this),c=b.nextUntil(".ui-multiselect-optgroup-label").filter(function(){return"none"!==a.css(this,"display")}).length;b[c?"show":"hide"]()})},_reset:function(){this.input.val("").trigger("keyup")},updateCache:function(){this.rows=this.instance.menu.find(".ui-multiselect-checkboxes li:not(.ui-multiselect-optgroup-label)");this.cache=this.element.children().map(function(){var b=a(this);"optgroup"===this.tagName.toLowerCase()&&(b=b.children());return b.map(function(){return this.innerHTML.toLowerCase()}).get()}).get()},widget:function(){return this.wrapper},destroy:function(){a.Widget.prototype.destroy.call(this);this.input.val("").trigger("keyup");this.wrapper.remove()}})})(jQuery);

/*

 FullCalendar v1.5.4
 http://arshaw.com/fullcalendar/

 Copyright (c) 2011 Adam Shaw
 Dual licensed under the MIT and GPL licenses, located in
 MIT-LICENSE.txt and GPL-LICENSE.txt respectively.

 Date: Tue Sep 4 23:38:33 2012 -0700

*/
(function($,undefined){var defaults={defaultView:"month",aspectRatio:1.35,header:{left:"title",center:"",right:"today prev,next"},weekends:true,allDayDefault:true,ignoreTimezone:true,lazyFetching:true,startParam:"start",endParam:"end",titleFormat:{month:"MMMM yyyy",week:"MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}",day:"dddd, MMM d, yyyy"},columnFormat:{month:"ddd",week:"ddd M/d",day:"dddd M/d"},timeFormat:{"":"h(:mm)t"},isRTL:false,firstDay:0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],buttonText:{prev:"&nbsp;&#9668;&nbsp;",next:"&nbsp;&#9658;&nbsp;",prevYear:"&nbsp;&lt;&lt;&nbsp;",nextYear:"&nbsp;&gt;&gt;&nbsp;",today:"today",month:"month",week:"week",day:"day"},theme:false,buttonIcons:{prev:"circle-triangle-w",next:"circle-triangle-e"},unselectAuto:true,dropAccept:"*"};var rtlDefaults={header:{left:"next,prev today",center:"",right:"title"},buttonText:{prev:"&nbsp;&#9658;&nbsp;",next:"&nbsp;&#9668;&nbsp;",prevYear:"&nbsp;&gt;&gt;&nbsp;",nextYear:"&nbsp;&lt;&lt;&nbsp;"},buttonIcons:{prev:"circle-triangle-e",next:"circle-triangle-w"}};var fc=$.fullCalendar={version:"1.5.4"};var fcViews=fc.views={};$.fn.fullCalendar=function(options){if(typeof options=="string"){var args=Array.prototype.slice.call(arguments,1);var res;this.each(function(){var calendar=$.data(this,"fullCalendar");if(calendar&&$.isFunction(calendar[options])){var r=calendar[options].apply(calendar,args);if(res===undefined){res=r;}if(options=="destroy"){$.removeData(this,"fullCalendar");}}});if(res!==undefined){return res;}return this;}var eventSources=options.eventSources||[];delete options.eventSources;if(options.events){eventSources.push(options.events);delete options.events;}options=$.extend(true,{},defaults,(options.isRTL||options.isRTL===undefined&&defaults.isRTL)?rtlDefaults:{},options);this.each(function(i,_element){var element=$(_element);var calendar=new Calendar(element,options,eventSources);element.data("fullCalendar",calendar);calendar.render();});return this;};function setDefaults(d){$.extend(true,defaults,d);}function Calendar(element,options,eventSources){var t=this;t.options=options;t.render=render;t.destroy=destroy;t.refetchEvents=refetchEvents;t.reportEvents=reportEvents;t.reportEventChange=reportEventChange;t.rerenderEvents=rerenderEvents;t.changeView=changeView;t.select=select;t.unselect=unselect;t.prev=prev;t.next=next;t.prevYear=prevYear;t.nextYear=nextYear;t.today=today;t.gotoDate=gotoDate;t.incrementDate=incrementDate;t.formatDate=function(format,date){return formatDate(format,date,options);};t.formatDates=function(format,date1,date2){return formatDates(format,date1,date2,options);};t.getDate=getDate;t.getView=getView;t.option=option;t.trigger=trigger;EventManager.call(t,options,eventSources);var isFetchNeeded=t.isFetchNeeded;var fetchEvents=t.fetchEvents;var _element=element[0];var header;var headerElement;var content;var tm;var currentView;var viewInstances={};var elementOuterWidth;var suggestedViewHeight;var absoluteViewElement;var resizeUID=0;var ignoreWindowResize=0;var date=new Date();var events=[];var _dragElement;setYMD(date,options.year,options.month,options.date);function render(inc){if(!content){initialRender();}else{calcSize();markSizesDirty();markEventsDirty();renderView(inc);}}function initialRender(){tm=options.theme?"ui":"fc";element.addClass("fc");if(options.isRTL){element.addClass("fc-rtl");}if(options.theme){element.addClass("ui-widget");}content=$("<div class='fc-content' style='position:relative'/>").prependTo(element);header=new Header(t,options);headerElement=header.render();if(headerElement){element.prepend(headerElement);}changeView(options.defaultView);$(window).resize(windowResize);if(!bodyVisible()){lateRender();}}function lateRender(){setTimeout(function(){if(!currentView.start&&bodyVisible()){renderView();}},0);}function destroy(){$(window).unbind("resize",windowResize);header.destroy();content.remove();element.removeClass("fc fc-rtl ui-widget");}function elementVisible(){return _element.offsetWidth!==0;}function bodyVisible(){return $("body")[0].offsetWidth!==0;}function changeView(newViewName){if(!currentView||newViewName!=currentView.name){ignoreWindowResize++;unselect();var oldView=currentView;var newViewElement;if(oldView){(oldView.beforeHide||noop)();setMinHeight(content,content.height());oldView.element.hide();}else{setMinHeight(content,1);}content.css("overflow","hidden");currentView=viewInstances[newViewName];if(currentView){currentView.element.show();}else{currentView=viewInstances[newViewName]=new fcViews[newViewName](newViewElement=absoluteViewElement=$("<div class='fc-view fc-view-"+newViewName+"' style='position:absolute'/>").appendTo(content),t);}if(oldView){header.deactivateButton(oldView.name);}header.activateButton(newViewName);renderView();content.css("overflow","");if(oldView){setMinHeight(content,1);}if(!newViewElement){(currentView.afterShow||noop)();}ignoreWindowResize--;}}function renderView(inc){if(elementVisible()){ignoreWindowResize++;unselect();if(suggestedViewHeight===undefined){calcSize();}var forceEventRender=false;if(!currentView.start||inc||date<currentView.start||date>=currentView.end){currentView.render(date,inc||0);setSize(true);forceEventRender=true;}else{if(currentView.sizeDirty){currentView.clearEvents();setSize();forceEventRender=true;}else{if(currentView.eventsDirty){currentView.clearEvents();forceEventRender=true;}}}currentView.sizeDirty=false;currentView.eventsDirty=false;updateEvents(forceEventRender);elementOuterWidth=element.outerWidth();header.updateTitle(currentView.title);var today=new Date();if(today>=currentView.start&&today<currentView.end){header.disableButton("today");}else{header.enableButton("today");}ignoreWindowResize--;currentView.trigger("viewDisplay",_element);}}function updateSize(){markSizesDirty();if(elementVisible()){calcSize();setSize();unselect();currentView.clearEvents();currentView.renderEvents(events);currentView.sizeDirty=false;}}function markSizesDirty(){$.each(viewInstances,function(i,inst){inst.sizeDirty=true;});}function calcSize(){if(options.contentHeight){suggestedViewHeight=options.contentHeight;}else{if(options.height){suggestedViewHeight=options.height-(headerElement?headerElement.height():0)-vsides(content);}else{suggestedViewHeight=Math.round(content.width()/Math.max(options.aspectRatio,0.5));}}}function setSize(dateChanged){ignoreWindowResize++;currentView.setHeight(suggestedViewHeight,dateChanged);if(absoluteViewElement){absoluteViewElement.css("position","relative");absoluteViewElement=null;}currentView.setWidth(content.width(),dateChanged);ignoreWindowResize--;}function windowResize(){if(!ignoreWindowResize){if(currentView.start){var uid=++resizeUID;setTimeout(function(){if(uid==resizeUID&&!ignoreWindowResize&&elementVisible()){if(elementOuterWidth!=(elementOuterWidth=element.outerWidth())){ignoreWindowResize++;updateSize();currentView.trigger("windowResize",_element);ignoreWindowResize--;}}},200);}else{lateRender();}}}function updateEvents(forceRender){if(!options.lazyFetching||isFetchNeeded(currentView.visStart,currentView.visEnd)){refetchEvents();}else{if(forceRender){rerenderEvents();}}}function refetchEvents(){fetchEvents(currentView.visStart,currentView.visEnd);}function reportEvents(_events){events=_events;rerenderEvents();}function reportEventChange(eventID){rerenderEvents(eventID);}function rerenderEvents(modifiedEventID){markEventsDirty();if(elementVisible()){currentView.clearEvents();currentView.renderEvents(events,modifiedEventID);currentView.eventsDirty=false;}}function markEventsDirty(){$.each(viewInstances,function(i,inst){inst.eventsDirty=true;});}function select(start,end,allDay){currentView.select(start,end,allDay===undefined?true:allDay);}function unselect(){if(currentView){currentView.unselect();}}function prev(){renderView(-1);}function next(){renderView(1);}function prevYear(){addYears(date,-1);renderView();}function nextYear(){addYears(date,1);renderView();}function today(){date=new Date();renderView();}function gotoDate(year,month,dateOfMonth){if(year instanceof Date){date=cloneDate(year);}else{setYMD(date,year,month,dateOfMonth);}renderView();}function incrementDate(years,months,days){if(years!==undefined){addYears(date,years);}if(months!==undefined){addMonths(date,months);}if(days!==undefined){addDays(date,days);}renderView();}function getDate(){return cloneDate(date);}function getView(){return currentView;}function option(name,value){if(value===undefined){return options[name];}if(name=="height"||name=="contentHeight"||name=="aspectRatio"){options[name]=value;updateSize();}}function trigger(name,thisObj){if(options[name]){return options[name].apply(thisObj||_element,Array.prototype.slice.call(arguments,2));}}if(options.droppable){$(document).bind("dragstart",function(ev,ui){var _e=ev.target;var e=$(_e);if(!e.parents(".fc").length){var accept=options.dropAccept;if($.isFunction(accept)?accept.call(_e,e):e.is(accept)){_dragElement=_e;currentView.dragStart(_dragElement,ev,ui);}}}).bind("dragstop",function(ev,ui){if(_dragElement){currentView.dragStop(_dragElement,ev,ui);_dragElement=null;}});}}function Header(calendar,options){var t=this;t.render=render;t.destroy=destroy;t.updateTitle=updateTitle;t.activateButton=activateButton;t.deactivateButton=deactivateButton;t.disableButton=disableButton;t.enableButton=enableButton;var element=$([]);var tm;function render(){tm=options.theme?"ui":"fc";var sections=options.header;if(sections){element=$("<table class='fc-header' style='width:100%'/>").append($("<tr/>").append(renderSection("left")).append(renderSection("center")).append(renderSection("right")));return element;}}function destroy(){element.remove();}function renderSection(position){var e=$("<td class='fc-header-"+position+"'/>");var buttonStr=options.header[position];if(buttonStr){$.each(buttonStr.split(" "),function(i){if(i>0){e.append("<span class='fc-header-space'/>");}var prevButton;$.each(this.split(","),function(j,buttonName){if(buttonName=="title"){e.append("<span class='fc-header-title'><h2>&nbsp;</h2></span>");if(prevButton){prevButton.addClass(tm+"-corner-right");}prevButton=null;}else{var buttonClick;if(calendar[buttonName]){buttonClick=calendar[buttonName];}else{if(fcViews[buttonName]){buttonClick=function(){button.removeClass(tm+"-state-hover");calendar.changeView(buttonName);};}}if(buttonClick){var icon=options.theme?smartProperty(options.buttonIcons,buttonName):null;var text=smartProperty(options.buttonText,buttonName);var button=$("<span class='fc-button fc-button-"+buttonName+" "+tm+"-state-default'>"+"<span class='fc-button-inner'>"+"<span class='fc-button-content'>"+(icon?"<span class='fc-icon-wrap'>"+"<span class='ui-icon ui-icon-"+icon+"'/>"+"</span>":text)+"</span>"+"<span class='fc-button-effect'><span></span></span>"+"</span>"+"</span>");if(button){button.click(function(){if(!button.hasClass(tm+"-state-disabled")){buttonClick();}}).mousedown(function(){button.not("."+tm+"-state-active").not("."+tm+"-state-disabled").addClass(tm+"-state-down");}).mouseup(function(){button.removeClass(tm+"-state-down");}).hover(function(){button.not("."+tm+"-state-active").not("."+tm+"-state-disabled").addClass(tm+"-state-hover");},function(){button.removeClass(tm+"-state-hover").removeClass(tm+"-state-down");}).appendTo(e);if(!prevButton){button.addClass(tm+"-corner-left");}prevButton=button;}}}});if(prevButton){prevButton.addClass(tm+"-corner-right");}});}return e;}function updateTitle(html){element.find("h2").html(html);}function activateButton(buttonName){element.find("span.fc-button-"+buttonName).addClass(tm+"-state-active");}function deactivateButton(buttonName){element.find("span.fc-button-"+buttonName).removeClass(tm+"-state-active");}function disableButton(buttonName){element.find("span.fc-button-"+buttonName).addClass(tm+"-state-disabled");}function enableButton(buttonName){element.find("span.fc-button-"+buttonName).removeClass(tm+"-state-disabled");}}fc.sourceNormalizers=[];fc.sourceFetchers=[];var ajaxDefaults={dataType:"json",cache:false};var eventGUID=1;function EventManager(options,_sources){var t=this;t.isFetchNeeded=isFetchNeeded;t.fetchEvents=fetchEvents;t.addEventSource=addEventSource;t.removeEventSource=removeEventSource;t.updateEvent=updateEvent;t.renderEvent=renderEvent;t.removeEvents=removeEvents;t.clientEvents=clientEvents;t.normalizeEvent=normalizeEvent;var trigger=t.trigger;var getView=t.getView;var reportEvents=t.reportEvents;var stickySource={events:[]};var sources=[stickySource];var rangeStart,rangeEnd;var currentFetchID=0;var pendingSourceCnt=0;var loadingLevel=0;var cache=[];for(var i=0;i<_sources.length;i++){_addEventSource(_sources[i]);}function isFetchNeeded(start,end){return !rangeStart||start<rangeStart||end>rangeEnd;}function fetchEvents(start,end){rangeStart=start;rangeEnd=end;cache=[];var fetchID=++currentFetchID;var len=sources.length;pendingSourceCnt=len;for(var i=0;i<len;i++){fetchEventSource(sources[i],fetchID);}}function fetchEventSource(source,fetchID){_fetchEventSource(source,function(events){if(fetchID==currentFetchID){if(events){for(var i=0;i<events.length;i++){events[i].source=source;normalizeEvent(events[i]);}cache=cache.concat(events);}pendingSourceCnt--;if(!pendingSourceCnt){reportEvents(cache);}}});}function _fetchEventSource(source,callback){var i;var fetchers=fc.sourceFetchers;var res;for(i=0;i<fetchers.length;i++){res=fetchers[i](source,rangeStart,rangeEnd,callback);if(res===true){return;}else{if(typeof res=="object"){_fetchEventSource(res,callback);return;}}}var events=source.events;if(events){if($.isFunction(events)){pushLoading();events(cloneDate(rangeStart),cloneDate(rangeEnd),function(events){callback(events);popLoading();});}else{if($.isArray(events)){callback(events);}else{callback();}}}else{var url=source.url;if(url){var success=source.success;var error=source.error;var complete=source.complete;var data=$.extend({},source.data||{});var startParam=firstDefined(source.startParam,options.startParam);var endParam=firstDefined(source.endParam,options.endParam);if(startParam){data[startParam]=Math.round(+rangeStart/1000);}if(endParam){data[endParam]=Math.round(+rangeEnd/1000);}pushLoading();$.ajax($.extend({},ajaxDefaults,source,{data:data,success:function(events){events=events||[];var res=applyAll(success,this,arguments);if($.isArray(res)){events=res;}callback(events);},error:function(){applyAll(error,this,arguments);callback();},complete:function(){applyAll(complete,this,arguments);popLoading();}}));}else{callback();}}}function addEventSource(source){source=_addEventSource(source);if(source){pendingSourceCnt++;fetchEventSource(source,currentFetchID);}}function _addEventSource(source){if($.isFunction(source)||$.isArray(source)){source={events:source};}else{if(typeof source=="string"){source={url:source};}}if(typeof source=="object"){normalizeSource(source);sources.push(source);return source;}}function removeEventSource(source){sources=$.grep(sources,function(src){return !isSourcesEqual(src,source);});cache=$.grep(cache,function(e){return !isSourcesEqual(e.source,source);});reportEvents(cache);}function updateEvent(event){var i,len=cache.length,e,defaultEventEnd=getView().defaultEventEnd,startDelta=event.start-event._start,endDelta=event.end?(event.end-(event._end||defaultEventEnd(event))):0;for(i=0;i<len;i++){e=cache[i];if(e._id==event._id&&e!=event){e.start=new Date(+e.start+startDelta);if(event.end){if(e.end){e.end=new Date(+e.end+endDelta);}else{e.end=new Date(+defaultEventEnd(e)+endDelta);}}else{e.end=null;}e.title=event.title;e.url=event.url;e.allDay=event.allDay;e.className=event.className;e.editable=event.editable;e.color=event.color;e.backgroudColor=event.backgroudColor;e.borderColor=event.borderColor;e.textColor=event.textColor;normalizeEvent(e);}}normalizeEvent(event);reportEvents(cache);}function renderEvent(event,stick){normalizeEvent(event);if(!event.source){if(stick){stickySource.events.push(event);event.source=stickySource;}cache.push(event);}reportEvents(cache);}function removeEvents(filter){if(!filter){cache=[];for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=[];}}}else{if(!$.isFunction(filter)){var id=filter+"";filter=function(e){return e._id==id;};}cache=$.grep(cache,filter,true);for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=$.grep(sources[i].events,filter,true);}}}reportEvents(cache);}function clientEvents(filter){if($.isFunction(filter)){return $.grep(cache,filter);}else{if(filter){filter+="";return $.grep(cache,function(e){return e._id==filter;});}}return cache;}function pushLoading(){if(!loadingLevel++){trigger("loading",null,true);}}function popLoading(){if(!--loadingLevel){trigger("loading",null,false);}}function normalizeEvent(event){var source=event.source||{};var ignoreTimezone=firstDefined(source.ignoreTimezone,options.ignoreTimezone);event._id=event._id||(event.id===undefined?"_fc"+eventGUID++:event.id+"");if(event.date){if(!event.start){event.start=event.date;}delete event.date;}event._start=cloneDate(event.start=parseDate(event.start,ignoreTimezone));event.end=parseDate(event.end,ignoreTimezone);if(event.end&&event.end<=event.start){event.end=null;}event._end=event.end?cloneDate(event.end):null;if(event.allDay===undefined){event.allDay=firstDefined(source.allDayDefault,options.allDayDefault);}if(event.className){if(typeof event.className=="string"){event.className=event.className.split(/\s+/);}}else{event.className=[];}}function normalizeSource(source){if(source.className){if(typeof source.className=="string"){source.className=source.className.split(/\s+/);}}else{source.className=[];}var normalizers=fc.sourceNormalizers;for(var i=0;i<normalizers.length;i++){normalizers[i](source);}}function isSourcesEqual(source1,source2){return source1&&source2&&getSourcePrimitive(source1)==getSourcePrimitive(source2);}function getSourcePrimitive(source){return((typeof source=="object")?(source.events||source.url):"")||source;}}fc.addDays=addDays;fc.cloneDate=cloneDate;fc.parseDate=parseDate;fc.parseISO8601=parseISO8601;fc.parseTime=parseTime;fc.formatDate=formatDate;fc.formatDates=formatDates;var dayIDs=["sun","mon","tue","wed","thu","fri","sat"],DAY_MS=86400000,HOUR_MS=3600000,MINUTE_MS=60000;function addYears(d,n,keepTime){d.setFullYear(d.getFullYear()+n);if(!keepTime){clearTime(d);}return d;}function addMonths(d,n,keepTime){if(+d){var m=d.getMonth()+n,check=cloneDate(d);check.setDate(1);check.setMonth(m);d.setMonth(m);if(!keepTime){clearTime(d);}while(d.getMonth()!=check.getMonth()){d.setDate(d.getDate()+(d<check?1:-1));}}return d;}function addDays(d,n,keepTime){if(+d){var dd=d.getDate()+n,check=cloneDate(d);check.setHours(9);check.setDate(dd);d.setDate(dd);if(!keepTime){clearTime(d);}fixDate(d,check);}return d;}function fixDate(d,check){if(+d){while(d.getDate()!=check.getDate()){d.setTime(+d+(d<check?1:-1)*HOUR_MS);}}}function addMinutes(d,n){d.setMinutes(d.getMinutes()+n);return d;}function clearTime(d){d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);return d;}function cloneDate(d,dontKeepTime){if(dontKeepTime){return clearTime(new Date(+d));}return new Date(+d);}function zeroDate(){var i=0,d;do{d=new Date(1970,i++,1);}while(d.getHours());return d;}function skipWeekend(date,inc,excl){inc=inc||1;while(!date.getDay()||(excl&&date.getDay()==1||!excl&&date.getDay()==6)){addDays(date,inc);}return date;}function dayDiff(d1,d2){return Math.round((cloneDate(d1,true)-cloneDate(d2,true))/DAY_MS);}function setYMD(date,y,m,d){if(y!==undefined&&y!=date.getFullYear()){date.setDate(1);date.setMonth(0);date.setFullYear(y);}if(m!==undefined&&m!=date.getMonth()){date.setDate(1);date.setMonth(m);}if(d!==undefined){date.setDate(d);}}function parseDate(s,ignoreTimezone){if(typeof s=="object"){return s;}if(typeof s=="number"){return new Date(s*1000);}if(typeof s=="string"){if(s.match(/^\d+(\.\d+)?$/)){return new Date(parseFloat(s)*1000);}if(ignoreTimezone===undefined){ignoreTimezone=true;}return parseISO8601(s,ignoreTimezone)||(s?new Date(s):null);}return null;}function parseISO8601(s,ignoreTimezone){var m=s.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!m){return null;}var date=new Date(m[1],0,1);if(ignoreTimezone||!m[13]){var check=new Date(m[1],0,1,9,0);if(m[3]){date.setMonth(m[3]-1);check.setMonth(m[3]-1);}if(m[5]){date.setDate(m[5]);check.setDate(m[5]);}fixDate(date,check);if(m[7]){date.setHours(m[7]);}if(m[8]){date.setMinutes(m[8]);}if(m[10]){date.setSeconds(m[10]);}if(m[12]){date.setMilliseconds(Number("0."+m[12])*1000);}fixDate(date,check);}else{date.setUTCFullYear(m[1],m[3]?m[3]-1:0,m[5]||1);date.setUTCHours(m[7]||0,m[8]||0,m[10]||0,m[12]?Number("0."+m[12])*1000:0);if(m[14]){var offset=Number(m[16])*60+(m[18]?Number(m[18]):0);offset*=m[15]=="-"?1:-1;date=new Date(+date+(offset*60*1000));}}return date;}function parseTime(s){if(typeof s=="number"){return s*60;}if(typeof s=="object"){return s.getHours()*60+s.getMinutes();}var m=s.match(/(\d+)(?::(\d+))?\s*(\w+)?/);if(m){var h=parseInt(m[1],10);if(m[3]){h%=12;if(m[3].toLowerCase().charAt(0)=="p"){h+=12;}}return h*60+(m[2]?parseInt(m[2],10):0);}}function formatDate(date,format,options){return formatDates(date,null,format,options);}function formatDates(date1,date2,format,options){options=options||defaults;var date=date1,otherDate=date2,i,len=format.length,c,i2,formatter,res="";for(i=0;i<len;i++){c=format.charAt(i);if(c=="'"){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)=="'"){if(date){if(i2==i+1){res+="'";}else{res+=format.substring(i+1,i2);}i=i2;}break;}}}else{if(c=="("){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==")"){var subres=formatDate(date,format.substring(i+1,i2),options);if(parseInt(subres.replace(/\D/,""),10)){res+=subres;}i=i2;break;}}}else{if(c=="["){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)=="]"){var subformat=format.substring(i+1,i2);var subres=formatDate(date,subformat,options);if(subres!=formatDate(otherDate,subformat,options)){res+=subres;}i=i2;break;}}}else{if(c=="{"){date=date2;otherDate=date1;}else{if(c=="}"){date=date1;otherDate=date2;}else{for(i2=len;i2>i;i2--){if(formatter=dateFormatters[format.substring(i,i2)]){if(date){res+=formatter(date,options);}i=i2-1;break;}}if(i2==i){if(date){res+=c;}}}}}}}}return res;}var dateFormatters={s:function(d){return d.getSeconds();},ss:function(d){return zeroPad(d.getSeconds());},m:function(d){return d.getMinutes();},mm:function(d){return zeroPad(d.getMinutes());},h:function(d){return d.getHours()%12||12;},hh:function(d){return zeroPad(d.getHours()%12||12);},H:function(d){return d.getHours();},HH:function(d){return zeroPad(d.getHours());},d:function(d){return d.getDate();},dd:function(d){return zeroPad(d.getDate());},ddd:function(d,o){return o.dayNamesShort[d.getDay()];},dddd:function(d,o){return o.dayNames[d.getDay()];},M:function(d){return d.getMonth()+1;},MM:function(d){return zeroPad(d.getMonth()+1);},MMM:function(d,o){return o.monthNamesShort[d.getMonth()];},MMMM:function(d,o){return o.monthNames[d.getMonth()];},yy:function(d){return(d.getFullYear()+"").substring(2);},yyyy:function(d){return d.getFullYear();},t:function(d){return d.getHours()<12?"a":"p";},tt:function(d){return d.getHours()<12?"am":"pm";},T:function(d){return d.getHours()<12?"A":"P";},TT:function(d){return d.getHours()<12?"AM":"PM";},u:function(d){return formatDate(d,"yyyy-MM-dd'T'HH:mm:ss'Z'");},S:function(d){var date=d.getDate();if(date>10&&date<20){return"th";}return["st","nd","rd"][date%10-1]||"th";}};fc.applyAll=applyAll;function exclEndDay(event){if(event.end){return _exclEndDay(event.end,event.allDay);}else{return addDays(cloneDate(event.start),1);}}function _exclEndDay(end,allDay){end=cloneDate(end);return allDay||end.getHours()||end.getMinutes()?addDays(end,1):clearTime(end);}function segCmp(a,b){var tryCmp=(b.msLength-a.msLength)*100+(a.event.start-b.event.start);if(tryCmp==0){return(a.event.title.toLowerCase()>=b.event.title.toLowerCase())?1:0;}return tryCmp;}function segsCollide(seg1,seg2){return seg1.end>seg2.start&&seg1.start<seg2.end;}function sliceSegs(events,visEventEnds,start,end){var segs=[],i,len=events.length,event,eventStart,eventEnd,segStart,segEnd,isStart,isEnd;for(i=0;i<len;i++){event=events[i];eventStart=event.start;eventEnd=visEventEnds[i];if(eventEnd>start&&eventStart<end){if(eventStart<start){segStart=cloneDate(start);isStart=false;}else{segStart=eventStart;isStart=true;}if(eventEnd>end){segEnd=cloneDate(end);isEnd=false;}else{segEnd=eventEnd;isEnd=true;}segs.push({event:event,start:segStart,end:segEnd,isStart:isStart,isEnd:isEnd,msLength:segEnd-segStart});}}return segs.sort(segCmp);}function stackSegs(segs){var levels=[],i,len=segs.length,seg,j,collide,k;for(i=0;i<len;i++){seg=segs[i];j=0;while(true){collide=false;if(levels[j]){for(k=0;k<levels[j].length;k++){if(segsCollide(levels[j][k],seg)){collide=true;break;}}}if(collide){j++;}else{break;}}if(levels[j]){levels[j].push(seg);}else{levels[j]=[seg];}}return levels;}function lazySegBind(container,segs,bindHandlers){container.unbind("mouseover").mouseover(function(ev){var parent=ev.target,e,i,seg;while(parent!=this){e=parent;parent=parent.parentNode;}if((i=e._fci)!==undefined){e._fci=undefined;seg=segs[i];bindHandlers(seg.event,seg.element,seg);$(ev.target).trigger(ev);}ev.stopPropagation();});}function setOuterWidth(element,width,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.width(Math.max(0,width-hsides(e,includeMargins)));}}function setOuterHeight(element,height,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.height(Math.max(0,height-vsides(e,includeMargins)));}}function hsides(element,includeMargins){return hpadding(element)+hborders(element)+(includeMargins?hmargins(element):0);}function hpadding(element){return(parseFloat($.css(element[0],"paddingLeft",true))||0)+(parseFloat($.css(element[0],"paddingRight",true))||0);}function hmargins(element){return(parseFloat($.css(element[0],"marginLeft",true))||0)+(parseFloat($.css(element[0],"marginRight",true))||0);}function hborders(element){return(parseFloat($.css(element[0],"borderLeftWidth",true))||0)+(parseFloat($.css(element[0],"borderRightWidth",true))||0);}function vsides(element,includeMargins){return vpadding(element)+vborders(element)+(includeMargins?vmargins(element):0);}function vpadding(element){return(parseFloat($.css(element[0],"paddingTop",true))||0)+(parseFloat($.css(element[0],"paddingBottom",true))||0);}function vmargins(element){return(parseFloat($.css(element[0],"marginTop",true))||0)+(parseFloat($.css(element[0],"marginBottom",true))||0);}function vborders(element){return(parseFloat($.css(element[0],"borderTopWidth",true))||0)+(parseFloat($.css(element[0],"borderBottomWidth",true))||0);}function setMinHeight(element,height){height=(typeof height=="number"?height+"px":height);element.each(function(i,_element){_element.style.cssText+=";min-height:"+height+";_height:"+height;});}function noop(){}function cmp(a,b){return a-b;}function arrayMax(a){return Math.max.apply(Math,a);}function zeroPad(n){return(n<10?"0":"")+n;}function smartProperty(obj,name){if(obj[name]!==undefined){return obj[name];}var parts=name.split(/(?=[A-Z])/),i=parts.length-1,res;for(;i>=0;i--){res=obj[parts[i].toLowerCase()];if(res!==undefined){return res;}}return obj[""];}function htmlEscape(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;").replace(/\n/g,"<br />");}function cssKey(_element){return _element.id+"/"+_element.className+"/"+_element.style.cssText.replace(/(^|;)\s*(top|left|width|height)\s*:[^;]*/ig,"");}function disableTextSelection(element){element.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false;});}function markFirstLast(e){e.children().removeClass("fc-first fc-last").filter(":first-child").addClass("fc-first").end().filter(":last-child").addClass("fc-last");}function setDayID(cell,date){cell.each(function(i,_cell){_cell.className=_cell.className.replace(/^fc-\w*/,"fc-"+dayIDs[date.getDay()]);});}function getSkinCss(event,opt){var source=event.source||{};var eventColor=event.color;var sourceColor=source.color;var optionColor=opt("eventColor");var backgroundColor=event.backgroundColor||eventColor||source.backgroundColor||sourceColor||opt("eventBackgroundColor")||optionColor;var borderColor=event.borderColor||eventColor||source.borderColor||sourceColor||opt("eventBorderColor")||optionColor;var textColor=event.textColor||source.textColor||opt("eventTextColor");var statements=[];if(backgroundColor){statements.push("background-color:"+backgroundColor);}if(borderColor){statements.push("border-color:"+borderColor);}if(textColor){statements.push("color:"+textColor);}return statements.join(";");}function applyAll(functions,thisObj,args){if($.isFunction(functions)){functions=[functions];}if(functions){var i;var ret;for(i=0;i<functions.length;i++){ret=functions[i].apply(thisObj,args)||ret;}return ret;}}function firstDefined(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined){return arguments[i];}}}fcViews.month=MonthView;function MonthView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,"month");var opt=t.opt;var renderBasic=t.renderBasic;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addMonths(date,delta);date.setDate(1);}var start=cloneDate(date,true);start.setDate(1);var end=addMonths(cloneDate(start),1);var visStart=cloneDate(start);var visEnd=cloneDate(end);var firstDay=opt("firstDay");var nwe=opt("weekends")?0:1;if(nwe){skipWeekend(visStart);skipWeekend(visEnd,-1,true);}addDays(visStart,-((visStart.getDay()-Math.max(firstDay,nwe)+7)%7));addDays(visEnd,(7-visEnd.getDay()+Math.max(firstDay,nwe))%7);var rowCnt=Math.round((visEnd-visStart)/(DAY_MS*7));if(opt("weekMode")=="fixed"){addDays(visEnd,(6-rowCnt)*7);rowCnt=6;}t.title=formatDate(start,opt("titleFormat"));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderBasic(6,rowCnt,nwe?5:7,true);}}fcViews.basicWeek=BasicWeekView;function BasicWeekView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,"basicWeek");var opt=t.opt;var renderBasic=t.renderBasic;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7);}var start=addDays(cloneDate(date),-((date.getDay()-opt("firstDay")+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);var visEnd=cloneDate(end);var weekends=opt("weekends");if(!weekends){skipWeekend(visStart);skipWeekend(visEnd,-1,true);}t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt("titleFormat"));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderBasic(1,1,weekends?7:5,false);}}fcViews.basicDay=BasicDayView;function BasicDayView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,"basicDay");var opt=t.opt;var renderBasic=t.renderBasic;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);if(!opt("weekends")){skipWeekend(date,delta<0?-1:1);}}t.title=formatDate(date,opt("titleFormat"));t.start=t.visStart=cloneDate(date,true);t.end=t.visEnd=addDays(cloneDate(t.start),1);renderBasic(1,1,1,false);}}setDefaults({weekMode:"fixed"});function BasicView(element,calendar,viewName){var t=this;t.renderBasic=renderBasic;t.setHeight=setHeight;t.setWidth=setWidth;t.renderDayOverlay=renderDayOverlay;t.defaultSelectionEnd=defaultSelectionEnd;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;t.defaultEventEnd=defaultEventEnd;t.getHoverListener=function(){return hoverListener;};t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.dayOfWeekCol=dayOfWeekCol;t.dateCell=dateCell;t.cellDate=cellDate;t.cellIsAllDay=function(){return true;};t.allDayRow=allDayRow;t.allDayBounds=allDayBounds;t.getRowCnt=function(){return rowCnt;};t.getColCnt=function(){return colCnt;};t.getColWidth=function(){return colWidth;};t.getDaySegmentContainer=function(){return daySegmentContainer;};View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);BasicEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var clearEvents=t.clearEvents;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var daySelectionMousedown=t.daySelectionMousedown;var formatDate=calendar.formatDate;var head;var headCells;var body;var bodyRows;var bodyCells;var bodyFirstCells;var bodyCellTopInners;var daySegmentContainer;var viewWidth;var viewHeight;var colWidth;var rowCnt,colCnt;var coordinateGrid;var hoverListener;var colContentPositions;var rtl,dis,dit;var firstDay;var nwe;var tm;var colFormat;disableTextSelection(element.addClass("fc-grid"));function renderBasic(maxr,r,c,showNumbers){rowCnt=r;colCnt=c;updateOptions();var firstTime=!body;if(firstTime){buildSkeleton(maxr,showNumbers);}else{clearEvents();}updateCells(firstTime);}function updateOptions(){rtl=opt("isRTL");if(rtl){dis=-1;dit=colCnt-1;}else{dis=1;dit=0;}firstDay=opt("firstDay");nwe=opt("weekends")?0:1;tm=opt("theme")?"ui":"fc";colFormat=opt("columnFormat");}function buildSkeleton(maxRowCnt,showNumbers){var s;var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var i,j;var table;s="<table class='fc-border-separate' style='width:100%' cellspacing='0'>"+"<thead>"+"<tr>";for(i=0;i<colCnt;i++){s+="<th class='fc- "+headerClass+"'/>";}s+="</tr>"+"</thead>"+"<tbody>";for(i=0;i<maxRowCnt;i++){s+="<tr class='fc-week"+i+"'>";for(j=0;j<colCnt;j++){s+="<td class='fc- "+contentClass+" fc-day"+(i*colCnt+j)+"'>"+"<div>"+(showNumbers?"<div class='fc-day-number'/>":"")+"<div class='fc-day-content'>"+"<div style='position:relative'>&nbsp;</div>"+"</div>"+"</div>"+"</td>";}s+="</tr>";}s+="</tbody>"+"</table>";table=$(s).appendTo(element);head=table.find("thead");headCells=head.find("th");body=table.find("tbody");bodyRows=body.find("tr");bodyCells=body.find("td");bodyFirstCells=bodyCells.filter(":first-child");bodyCellTopInners=bodyRows.eq(0).find("div.fc-day-content div");markFirstLast(head.add(head.find("tr")));markFirstLast(bodyRows);bodyRows.eq(0).addClass("fc-first");dayBind(bodyCells);daySegmentContainer=$("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(element);}function updateCells(firstTime){var dowDirty=firstTime||rowCnt==1;var month=t.start.getMonth();var today=clearTime(new Date());var cell;var date;var row;if(dowDirty){headCells.each(function(i,_cell){cell=$(_cell);date=indexDate(i);cell.html(formatDate(date,colFormat));setDayID(cell,date);});}bodyCells.each(function(i,_cell){cell=$(_cell);date=indexDate(i);if(date.getMonth()==month){cell.removeClass("fc-other-month");}else{cell.addClass("fc-other-month");}if(+date==+today){cell.addClass(tm+"-state-highlight fc-today");}else{cell.removeClass(tm+"-state-highlight fc-today");}cell.find("div.fc-day-number").text(date.getDate());if(dowDirty){setDayID(cell,date);}});bodyRows.each(function(i,_row){row=$(_row);if(i<rowCnt){row.show();if(i==rowCnt-1){row.addClass("fc-last");}else{row.removeClass("fc-last");}}else{row.hide();}});}function setHeight(height){viewHeight=height;var bodyHeight=viewHeight-head.height();var rowHeight;var rowHeightLast;var cell;if(opt("weekMode")=="variable"){rowHeight=rowHeightLast=Math.floor(bodyHeight/(rowCnt==1?2:6));}else{rowHeight=Math.floor(bodyHeight/rowCnt);rowHeightLast=bodyHeight-rowHeight*(rowCnt-1);}bodyFirstCells.each(function(i,_cell){if(i<rowCnt){cell=$(_cell);setMinHeight(cell.find("> div"),(i==rowCnt-1?rowHeightLast:rowHeight)-vsides(cell));}});}function setWidth(width){viewWidth=width;colContentPositions.clear();colWidth=Math.floor(viewWidth/colCnt);setOuterWidth(headCells.slice(0,-1),colWidth);}function dayBind(days){days.click(dayClick).mousedown(daySelectionMousedown);}function dayClick(ev){if(!opt("selectable")){var index=parseInt(this.className.match(/fc\-day(\d+)/)[1]);var date=indexDate(index);trigger("dayClick",this,date,true,ev);}}function renderDayOverlay(overlayStart,overlayEnd,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build();}var rowStart=cloneDate(t.visStart);var rowEnd=addDays(cloneDate(rowStart),colCnt);for(var i=0;i<rowCnt;i++){var stretchStart=new Date(Math.max(rowStart,overlayStart));var stretchEnd=new Date(Math.min(rowEnd,overlayEnd));if(stretchStart<stretchEnd){var colStart,colEnd;if(rtl){colStart=dayDiff(stretchEnd,rowStart)*dis+dit+1;colEnd=dayDiff(stretchStart,rowStart)*dis+dit+1;}else{colStart=dayDiff(stretchStart,rowStart);colEnd=dayDiff(stretchEnd,rowStart);}dayBind(renderCellOverlay(i,colStart,i,colEnd-1));}addDays(rowStart,7);addDays(rowEnd,7);}}function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,element);return renderOverlay(rect,element);}function defaultSelectionEnd(startDate,allDay){return cloneDate(startDate);}function renderSelection(startDate,endDate,allDay){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true);}function clearSelection(){clearOverlays();}function reportDayClick(date,allDay,ev){var cell=dateCell(date);var _element=bodyCells[cell.row*colCnt+cell.col];trigger("dayClick",_element,date,allDay,ev);}function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){renderCellOverlay(cell.row,cell.col,cell.row,cell.col);}},ev);}function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){var d=cellDate(cell);trigger("drop",_dragElement,d,true,ev,ui);}}function defaultEventEnd(event){return cloneDate(event.start);}coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;headCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n;}p=[n];cols[i]=p;});p[1]=n+e.outerWidth();bodyRows.each(function(i,_e){if(i<rowCnt){e=$(_e);n=e.offset().top;if(i){p[1]=n;}p=[n];rows[i]=p;}});p[1]=n+e.outerHeight();});hoverListener=new HoverListener(coordinateGrid);colContentPositions=new HorizontalPositionCache(function(col){return bodyCellTopInners.eq(col);});function colContentLeft(col){return colContentPositions.left(col);}function colContentRight(col){return colContentPositions.right(col);}function dateCell(date){return{row:Math.floor(dayDiff(date,t.visStart)/7),col:dayOfWeekCol(date.getDay())};}function cellDate(cell){return _cellDate(cell.row,cell.col);}function _cellDate(row,col){return addDays(cloneDate(t.visStart),row*7+col*dis+dit);}function indexDate(index){return _cellDate(Math.floor(index/colCnt),index%colCnt);}function dayOfWeekCol(dayOfWeek){return((dayOfWeek-Math.max(firstDay,nwe)+colCnt)%colCnt)*dis+dit;}function allDayRow(i){return bodyRows.eq(i);}function allDayBounds(i){return{left:0,right:viewWidth};}}function BasicEventRenderer(){var t=this;t.renderEvents=renderEvents;t.compileDaySegs=compileSegs;t.clearEvents=clearEvents;t.bindDaySeg=bindDaySeg;DayEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var reportEvents=t.reportEvents;var reportEventClear=t.reportEventClear;var eventElementHandlers=t.eventElementHandlers;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var getDaySegmentContainer=t.getDaySegmentContainer;var getHoverListener=t.getHoverListener;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var getRowCnt=t.getRowCnt;var getColCnt=t.getColCnt;var renderDaySegs=t.renderDaySegs;var resizableDayEvent=t.resizableDayEvent;function renderEvents(events,modifiedEventId){reportEvents(events);renderDaySegs(compileSegs(events),modifiedEventId);}function clearEvents(){reportEventClear();getDaySegmentContainer().empty();}function compileSegs(events){var rowCnt=getRowCnt(),colCnt=getColCnt(),d1=cloneDate(t.visStart),d2=addDays(cloneDate(d1),colCnt),visEventsEnds=$.map(events,exclEndDay),i,row,j,level,k,seg,segs=[];for(i=0;i<rowCnt;i++){row=stackSegs(sliceSegs(events,visEventsEnds,d1,d2));for(j=0;j<row.length;j++){level=row[j];for(k=0;k<level.length;k++){seg=level[k];seg.row=i;seg.level=j;segs.push(seg);}}addDays(d1,7);addDays(d2,7);}return segs;}function bindDaySeg(event,eventElement,seg){if(isEventDraggable(event)){draggableDayEvent(event,eventElement);}if(seg.isEnd&&isEventResizable(event)){resizableDayEvent(event,eventElement,seg);}eventElementHandlers(event,eventElement);}function draggableDayEvent(event,eventElement){var hoverListener=getHoverListener();var dayDelta;eventElement.draggable({zIndex:9,delay:50,opacity:opt("dragOpacity"),revertDuration:opt("dragRevertDuration"),start:function(ev,ui){trigger("eventDragStart",eventElement,event,ev,ui);hideEvents(event,eventElement);hoverListener.start(function(cell,origCell,rowDelta,colDelta){eventElement.draggable("option","revert",!cell||!rowDelta&&!colDelta);clearOverlays();if(cell){dayDelta=rowDelta*7+colDelta*(opt("isRTL")?-1:1);renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));}else{dayDelta=0;}},ev,"drag");},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger("eventDragStop",eventElement,event,ev,ui);if(dayDelta){eventDrop(this,event,dayDelta,0,event.allDay,ev,ui);}else{eventElement.css("filter","");showEvents(event,eventElement);}}});}}fcViews.agendaWeek=AgendaWeekView;function AgendaWeekView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,"agendaWeek");var opt=t.opt;var renderAgenda=t.renderAgenda;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7);}var start=addDays(cloneDate(date),-((date.getDay()-opt("firstDay")+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);var visEnd=cloneDate(end);var weekends=opt("weekends");if(!weekends){skipWeekend(visStart);skipWeekend(visEnd,-1,true);}t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt("titleFormat"));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderAgenda(weekends?7:5);}}fcViews.agendaDay=AgendaDayView;function AgendaDayView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,"agendaDay");var opt=t.opt;var renderAgenda=t.renderAgenda;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);if(!opt("weekends")){skipWeekend(date,delta<0?-1:1);}}var start=cloneDate(date,true);var end=addDays(cloneDate(start),1);t.title=formatDate(date,opt("titleFormat"));t.start=t.visStart=start;t.end=t.visEnd=end;renderAgenda(1);}}setDefaults({allDaySlot:true,allDayText:"all-day",firstHour:6,slotMinutes:30,defaultEventMinutes:120,axisFormat:"h(:mm)tt",timeFormat:{agenda:"h:mm{ - h:mm}"},dragOpacity:{agenda:0.5},minTime:0,maxTime:24});function AgendaView(element,calendar,viewName){var t=this;t.renderAgenda=renderAgenda;t.setWidth=setWidth;t.setHeight=setHeight;t.beforeHide=beforeHide;t.afterShow=afterShow;t.defaultEventEnd=defaultEventEnd;t.timePosition=timePosition;t.dayOfWeekCol=dayOfWeekCol;t.dateCell=dateCell;t.cellDate=cellDate;t.cellIsAllDay=cellIsAllDay;t.allDayRow=getAllDayRow;t.allDayBounds=allDayBounds;t.getHoverListener=function(){return hoverListener;};t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.getDaySegmentContainer=function(){return daySegmentContainer;};t.getSlotSegmentContainer=function(){return slotSegmentContainer;};t.getMinMinute=function(){return minMinute;};t.getMaxMinute=function(){return maxMinute;};t.getBodyContent=function(){return slotContent;};t.getRowCnt=function(){return 1;};t.getColCnt=function(){return colCnt;};t.getColWidth=function(){return colWidth;};t.getSlotHeight=function(){return slotHeight;};t.defaultSelectionEnd=defaultSelectionEnd;t.renderDayOverlay=renderDayOverlay;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);AgendaEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var clearEvents=t.clearEvents;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var reportSelection=t.reportSelection;var unselect=t.unselect;var daySelectionMousedown=t.daySelectionMousedown;var slotSegHtml=t.slotSegHtml;var formatDate=calendar.formatDate;var dayTable;var dayHead;var dayHeadCells;var dayBody;var dayBodyCells;var dayBodyCellInners;var dayBodyFirstCell;var dayBodyFirstCellStretcher;var slotLayer;var daySegmentContainer;var allDayTable;var allDayRow;var slotScroller;var slotContent;var slotSegmentContainer;var slotTable;var slotTableFirstInner;var axisFirstCells;var gutterCells;var selectionHelper;var viewWidth;var viewHeight;var axisWidth;var colWidth;var gutterWidth;var slotHeight;var savedScrollTop;var colCnt;var slotCnt;var coordinateGrid;var hoverListener;var colContentPositions;var slotTopCache={};var tm;var firstDay;var nwe;var rtl,dis,dit;var minMinute,maxMinute;var colFormat;disableTextSelection(element.addClass("fc-agenda"));function renderAgenda(c){colCnt=c;updateOptions();if(!dayTable){buildSkeleton();}else{clearEvents();}updateCells();}function updateOptions(){tm=opt("theme")?"ui":"fc";nwe=opt("weekends")?0:1;firstDay=opt("firstDay");if(rtl=opt("isRTL")){dis=-1;dit=colCnt-1;}else{dis=1;dit=0;}minMinute=parseTime(opt("minTime"));maxMinute=parseTime(opt("maxTime"));colFormat=opt("columnFormat");}function buildSkeleton(){var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var s;var i;var d;var maxd;var minutes;var slotNormal=opt("slotMinutes")%15==0;s="<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'>"+"<thead>"+"<tr>"+"<th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";for(i=0;i<colCnt;i++){s+="<th class='fc- fc-col"+i+" "+headerClass+"'/>";}s+="<th class='fc-agenda-gutter "+headerClass+"'>&nbsp;</th>"+"</tr>"+"</thead>"+"<tbody>"+"<tr>"+"<th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";for(i=0;i<colCnt;i++){s+="<td class='fc- fc-col"+i+" "+contentClass+"'>"+"<div>"+"<div class='fc-day-content'>"+"<div style='position:relative'>&nbsp;</div>"+"</div>"+"</div>"+"</td>";}s+="<td class='fc-agenda-gutter "+contentClass+"'>&nbsp;</td>"+"</tr>"+"</tbody>"+"</table>";dayTable=$(s).appendTo(element);dayHead=dayTable.find("thead");dayHeadCells=dayHead.find("th").slice(1,-1);dayBody=dayTable.find("tbody");dayBodyCells=dayBody.find("td").slice(0,-1);dayBodyCellInners=dayBodyCells.find("div.fc-day-content div");dayBodyFirstCell=dayBodyCells.eq(0);dayBodyFirstCellStretcher=dayBodyFirstCell.find("> div");markFirstLast(dayHead.add(dayHead.find("tr")));markFirstLast(dayBody.add(dayBody.find("tr")));axisFirstCells=dayHead.find("th:first");gutterCells=dayTable.find(".fc-agenda-gutter");slotLayer=$("<div style='position:absolute;z-index:2;left:0;width:100%'/>").appendTo(element);if(opt("allDaySlot")){daySegmentContainer=$("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotLayer);s="<table style='width:100%' class='fc-agenda-allday' cellspacing='0'>"+"<tr>"+"<th class='"+headerClass+" fc-agenda-axis'>"+opt("allDayText")+"</th>"+"<td>"+"<div class='fc-day-content'><div style='position:relative'/></div>"+"</td>"+"<th class='"+headerClass+" fc-agenda-gutter'>&nbsp;</th>"+"</tr>"+"</table>";allDayTable=$(s).appendTo(slotLayer);allDayRow=allDayTable.find("tr");dayBind(allDayRow.find("td"));axisFirstCells=axisFirstCells.add(allDayTable.find("th:first"));gutterCells=gutterCells.add(allDayTable.find("th.fc-agenda-gutter"));slotLayer.append("<div class='fc-agenda-divider "+headerClass+"'>"+"<div class='fc-agenda-divider-inner'/>"+"</div>");}else{daySegmentContainer=$([]);}slotScroller=$("<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>").appendTo(slotLayer);slotContent=$("<div style='position:relative;width:100%;overflow:hidden'/>").appendTo(slotScroller);slotSegmentContainer=$("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotContent);s="<table class='fc-agenda-slots' style='width:100%' cellspacing='0'>"+"<tbody>";d=zeroDate();maxd=addMinutes(cloneDate(d),maxMinute);addMinutes(d,minMinute);slotCnt=0;for(i=0;d<maxd;i++){minutes=d.getMinutes();s+="<tr class='fc-slot"+i+" "+(!minutes?"":"fc-minor")+"'>"+"<th class='fc-agenda-axis "+headerClass+"'>"+((!slotNormal||!minutes)?formatDate(d,opt("axisFormat")):"&nbsp;")+"</th>"+"<td class='"+contentClass+"'>"+"<div style='position:relative'>&nbsp;</div>"+"</td>"+"</tr>";addMinutes(d,opt("slotMinutes"));slotCnt++;}s+="</tbody>"+"</table>";slotTable=$(s).appendTo(slotContent);slotTableFirstInner=slotTable.find("div:first");slotBind(slotTable.find("td"));axisFirstCells=axisFirstCells.add(slotTable.find("th:first"));}function updateCells(){var i;var headCell;var bodyCell;var date;var today=clearTime(new Date());for(i=0;i<colCnt;i++){date=colDate(i);headCell=dayHeadCells.eq(i);headCell.html(formatDate(date,colFormat));bodyCell=dayBodyCells.eq(i);if(+date==+today){bodyCell.addClass(tm+"-state-highlight fc-today");}else{bodyCell.removeClass(tm+"-state-highlight fc-today");}setDayID(headCell.add(bodyCell),date);}}function setHeight(height,dateChanged){if(height===undefined){height=viewHeight;}viewHeight=height;slotTopCache={};var headHeight=dayBody.position().top;var allDayHeight=slotScroller.position().top;var bodyHeight=Math.min(height-headHeight,slotTable.height()+allDayHeight+1);dayBodyFirstCellStretcher.height(bodyHeight-vsides(dayBodyFirstCell));slotLayer.css("top",headHeight);slotScroller.height(bodyHeight-allDayHeight-1);slotHeight=slotTableFirstInner.height()+1;if(dateChanged){resetScroll();}}function setWidth(width){viewWidth=width;colContentPositions.clear();axisWidth=0;setOuterWidth(axisFirstCells.width("").each(function(i,_cell){axisWidth=Math.max(axisWidth,$(_cell).outerWidth());}),axisWidth);var slotTableWidth=slotScroller[0].clientWidth;gutterWidth=slotScroller.width()-slotTableWidth;if(gutterWidth){setOuterWidth(gutterCells,gutterWidth);gutterCells.show().prev().removeClass("fc-last");}else{gutterCells.hide().prev().addClass("fc-last");}colWidth=Math.floor((slotTableWidth-axisWidth)/colCnt);setOuterWidth(dayHeadCells.slice(0,-1),colWidth);}function resetScroll(){var d0=zeroDate();var scrollDate=cloneDate(d0);scrollDate.setHours(opt("firstHour"));var top=timePosition(d0,scrollDate)+1;function scroll(){slotScroller.scrollTop(top);}scroll();setTimeout(scroll,0);}function beforeHide(){savedScrollTop=slotScroller.scrollTop();}function afterShow(){slotScroller.scrollTop(savedScrollTop);}function dayBind(cells){cells.click(slotClick).mousedown(daySelectionMousedown);}function slotBind(cells){cells.click(slotClick).mousedown(slotSelectionMousedown);}function slotClick(ev){if(!opt("selectable")){var col=Math.min(colCnt-1,Math.floor((ev.pageX-dayTable.offset().left-axisWidth)/colWidth));var date=colDate(col);var rowMatch=this.parentNode.className.match(/fc-slot(\d+)/);if(rowMatch){var mins=parseInt(rowMatch[1])*opt("slotMinutes");var hours=Math.floor(mins/60);date.setHours(hours);date.setMinutes(mins%60+minMinute);trigger("dayClick",dayBodyCells[col],date,false,ev);}else{trigger("dayClick",dayBodyCells[col],date,true,ev);}}}function renderDayOverlay(startDate,endDate,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build();}var visStart=cloneDate(t.visStart);var startCol,endCol;if(rtl){startCol=dayDiff(endDate,visStart)*dis+dit+1;endCol=dayDiff(startDate,visStart)*dis+dit+1;}else{startCol=dayDiff(startDate,visStart);endCol=dayDiff(endDate,visStart);}startCol=Math.max(0,startCol);endCol=Math.min(colCnt,endCol);if(startCol<endCol){dayBind(renderCellOverlay(0,startCol,0,endCol-1));}}function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,slotLayer);return renderOverlay(rect,slotLayer);}function renderSlotOverlay(overlayStart,overlayEnd){var dayStart=cloneDate(t.visStart);var dayEnd=addDays(cloneDate(dayStart),1);for(var i=0;i<colCnt;i++){var stretchStart=new Date(Math.max(dayStart,overlayStart));var stretchEnd=new Date(Math.min(dayEnd,overlayEnd));if(stretchStart<stretchEnd){var col=i*dis+dit;var rect=coordinateGrid.rect(0,col,0,col,slotContent);var top=timePosition(dayStart,stretchStart);var bottom=timePosition(dayStart,stretchEnd);rect.top=top;rect.height=bottom-top;slotBind(renderOverlay(rect,slotContent));}addDays(dayStart,1);addDays(dayEnd,1);}}coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;dayHeadCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n;}p=[n];cols[i]=p;});p[1]=n+e.outerWidth();if(opt("allDaySlot")){e=allDayRow;n=e.offset().top;rows[0]=[n,n+e.outerHeight()];}var slotTableTop=slotContent.offset().top;var slotScrollerTop=slotScroller.offset().top;var slotScrollerBottom=slotScrollerTop+slotScroller.outerHeight();function constrain(n){return Math.max(slotScrollerTop,Math.min(slotScrollerBottom,n));}for(var i=0;i<slotCnt;i++){rows.push([constrain(slotTableTop+slotHeight*i),constrain(slotTableTop+slotHeight*(i+1))]);}});hoverListener=new HoverListener(coordinateGrid);colContentPositions=new HorizontalPositionCache(function(col){return dayBodyCellInners.eq(col);});function colContentLeft(col){return colContentPositions.left(col);}function colContentRight(col){return colContentPositions.right(col);}function dateCell(date){return{row:Math.floor(dayDiff(date,t.visStart)/7),col:dayOfWeekCol(date.getDay())};}function cellDate(cell){var d=colDate(cell.col);var slotIndex=cell.row;if(opt("allDaySlot")){slotIndex--;}if(slotIndex>=0){addMinutes(d,minMinute+slotIndex*opt("slotMinutes"));}return d;}function colDate(col){return addDays(cloneDate(t.visStart),col*dis+dit);}function cellIsAllDay(cell){return opt("allDaySlot")&&!cell.row;}function dayOfWeekCol(dayOfWeek){return((dayOfWeek-Math.max(firstDay,nwe)+colCnt)%colCnt)*dis+dit;}function timePosition(day,time){day=cloneDate(day,true);if(time<addMinutes(cloneDate(day),minMinute)){return 0;}if(time>=addMinutes(cloneDate(day),maxMinute)){return slotTable.height();}var slotMinutes=opt("slotMinutes"),minutes=time.getHours()*60+time.getMinutes()-minMinute,slotI=Math.floor(minutes/slotMinutes),slotTop=slotTopCache[slotI];if(slotTop===undefined){slotTop=slotTopCache[slotI]=slotTable.find("tr:eq("+slotI+") td div")[0].offsetTop;}return Math.max(0,Math.round(slotTop-1+slotHeight*((minutes%slotMinutes)/slotMinutes)));}function allDayBounds(){return{left:axisWidth,right:viewWidth-gutterWidth};}function getAllDayRow(index){return allDayRow;}function defaultEventEnd(event){var start=cloneDate(event.start);if(event.allDay){return start;}return addMinutes(start,opt("defaultEventMinutes"));}function defaultSelectionEnd(startDate,allDay){if(allDay){return cloneDate(startDate);}return addMinutes(cloneDate(startDate),opt("slotMinutes"));}function renderSelection(startDate,endDate,allDay){if(allDay){if(opt("allDaySlot")){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true);}}else{renderSlotSelection(startDate,endDate);}}function renderSlotSelection(startDate,endDate){var helperOption=opt("selectHelper");coordinateGrid.build();if(helperOption){var col=dayDiff(startDate,t.visStart)*dis+dit;if(col>=0&&col<colCnt){var rect=coordinateGrid.rect(0,col,0,col,slotContent);var top=timePosition(startDate,startDate);var bottom=timePosition(startDate,endDate);if(bottom>top){rect.top=top;rect.height=bottom-top;rect.left+=2;rect.width-=5;if($.isFunction(helperOption)){var helperRes=helperOption(startDate,endDate);if(helperRes){rect.position="absolute";rect.zIndex=8;selectionHelper=$(helperRes).css(rect).appendTo(slotContent);}}else{rect.isStart=true;rect.isEnd=true;selectionHelper=$(slotSegHtml({title:"",start:startDate,end:endDate,className:["fc-select-helper"],editable:false},rect));selectionHelper.css("opacity",opt("dragOpacity"));}if(selectionHelper){slotBind(selectionHelper);slotContent.append(selectionHelper);setOuterWidth(selectionHelper,rect.width,true);setOuterHeight(selectionHelper,rect.height,true);}}}}else{renderSlotOverlay(startDate,endDate);}}function clearSelection(){clearOverlays();if(selectionHelper){selectionHelper.remove();selectionHelper=null;}}function slotSelectionMousedown(ev){if(ev.which==1&&opt("selectable")){unselect(ev);var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&cell.col==origCell.col&&!cellIsAllDay(cell)){var d1=cellDate(origCell);var d2=cellDate(cell);dates=[d1,addMinutes(cloneDate(d1),opt("slotMinutes")),d2,addMinutes(cloneDate(d2),opt("slotMinutes"))].sort(cmp);renderSlotSelection(dates[0],dates[3]);}else{dates=null;}},ev);$(document).one("mouseup",function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],false,ev);}reportSelection(dates[0],dates[3],false,ev);}});}}function reportDayClick(date,allDay,ev){trigger("dayClick",dayBodyCells[dayOfWeekCol(date.getDay())],date,allDay,ev);}function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){if(cellIsAllDay(cell)){renderCellOverlay(cell.row,cell.col,cell.row,cell.col);}else{var d1=cellDate(cell);var d2=addMinutes(cloneDate(d1),opt("defaultEventMinutes"));renderSlotOverlay(d1,d2);}}},ev);}function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){trigger("drop",_dragElement,cellDate(cell),cellIsAllDay(cell),ev,ui);}}}function AgendaEventRenderer(){var t=this;t.renderEvents=renderEvents;t.compileDaySegs=compileDaySegs;t.clearEvents=clearEvents;t.slotSegHtml=slotSegHtml;t.bindDaySeg=bindDaySeg;DayEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var reportEvents=t.reportEvents;var reportEventClear=t.reportEventClear;var eventElementHandlers=t.eventElementHandlers;var setHeight=t.setHeight;var getDaySegmentContainer=t.getDaySegmentContainer;var getSlotSegmentContainer=t.getSlotSegmentContainer;var getHoverListener=t.getHoverListener;var getMaxMinute=t.getMaxMinute;var getMinMinute=t.getMinMinute;var timePosition=t.timePosition;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var renderDaySegs=t.renderDaySegs;var resizableDayEvent=t.resizableDayEvent;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var getSlotHeight=t.getSlotHeight;var getBodyContent=t.getBodyContent;var reportEventElement=t.reportEventElement;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var eventResize=t.eventResize;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var calendar=t.calendar;var formatDate=calendar.formatDate;var formatDates=calendar.formatDates;function renderEvents(events,modifiedEventId){reportEvents(events);var i,len=events.length,dayEvents=[],slotEvents=[];for(i=0;i<len;i++){if(events[i].allDay){dayEvents.push(events[i]);}else{slotEvents.push(events[i]);}}if(opt("allDaySlot")){renderDaySegs(compileDaySegs(dayEvents),modifiedEventId);setHeight();}renderSlotSegs(compileSlotSegs(slotEvents),modifiedEventId);}function clearEvents(){reportEventClear();getDaySegmentContainer().empty();getSlotSegmentContainer().empty();}function compileDaySegs(events){var levels=stackSegs(sliceSegs(events,$.map(events,exclEndDay),t.visStart,t.visEnd)),i,levelCnt=levels.length,level,j,seg,segs=[];for(i=0;i<levelCnt;i++){level=levels[i];for(j=0;j<level.length;j++){seg=level[j];seg.row=0;seg.level=i;segs.push(seg);}}return segs;}function compileSlotSegs(events){var colCnt=getColCnt(),minMinute=getMinMinute(),maxMinute=getMaxMinute(),d=addMinutes(cloneDate(t.visStart),minMinute),visEventEnds=$.map(events,slotEventEnd),i,col,j,level,k,seg,segs=[];for(i=0;i<colCnt;i++){col=stackSegs(sliceSegs(events,visEventEnds,d,addMinutes(cloneDate(d),maxMinute-minMinute)));countForwardSegs(col);for(j=0;j<col.length;j++){level=col[j];for(k=0;k<level.length;k++){seg=level[k];seg.col=i;seg.level=j;segs.push(seg);}}addDays(d,1,true);}return segs;}function slotEventEnd(event){if(event.end){return cloneDate(event.end);}else{return addMinutes(cloneDate(event.start),opt("defaultEventMinutes"));}}function renderSlotSegs(segs,modifiedEventId){var i,segCnt=segs.length,seg,event,classes,top,bottom,colI,levelI,forward,leftmost,availWidth,outerWidth,left,html="",eventElements,eventElement,triggerRes,vsideCache={},hsideCache={},key,val,contentElement,height,slotSegmentContainer=getSlotSegmentContainer(),rtl,dis,dit,colCnt=getColCnt();if(rtl=opt("isRTL")){dis=-1;dit=colCnt-1;}else{dis=1;dit=0;}for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;top=timePosition(seg.start,seg.start);bottom=timePosition(seg.start,seg.end);colI=seg.col;levelI=seg.level;forward=seg.forward||0;leftmost=colContentLeft(colI*dis+dit);availWidth=colContentRight(colI*dis+dit)-leftmost;availWidth=Math.min(availWidth-6,availWidth*0.95);if(levelI){outerWidth=availWidth/(levelI+forward+1);}else{if(forward){outerWidth=((availWidth/(forward+1))-(12/2))*2;}else{outerWidth=availWidth;}}left=leftmost+(availWidth/(levelI+forward+1)*levelI)*dis+(rtl?availWidth-outerWidth:0);seg.top=top;seg.left=left;seg.outerWidth=outerWidth;seg.outerHeight=bottom-top;html+=slotSegHtml(event,seg);}slotSegmentContainer[0].innerHTML=html;eventElements=slotSegmentContainer.children();for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;eventElement=$(eventElements[i]);triggerRes=trigger("eventRender",event,event,eventElement);if(triggerRes===false){eventElement.remove();}else{if(triggerRes&&triggerRes!==true){eventElement.remove();eventElement=$(triggerRes).css({position:"absolute",top:seg.top,left:seg.left}).appendTo(slotSegmentContainer);}seg.element=eventElement;if(event._id===modifiedEventId){bindSlotSeg(event,eventElement,seg);}else{eventElement[0]._fci=i;}reportEventElement(event,eventElement);}}lazySegBind(slotSegmentContainer,segs,bindSlotSeg);for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){val=vsideCache[key=seg.key=cssKey(eventElement[0])];seg.vsides=val===undefined?(vsideCache[key]=vsides(eventElement,true)):val;val=hsideCache[key];seg.hsides=val===undefined?(hsideCache[key]=hsides(eventElement,true)):val;contentElement=eventElement.find("div.fc-event-content");if(contentElement.length){seg.contentTop=contentElement[0].offsetTop;}}}for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){eventElement[0].style.width=Math.max(0,seg.outerWidth-seg.hsides)+"px";height=Math.max(0,seg.outerHeight-seg.vsides);eventElement[0].style.height=height+"px";event=seg.event;if(seg.contentTop!==undefined&&height-seg.contentTop<10){eventElement.find("div.fc-event-time").text(formatDate(event.start,opt("timeFormat"))+" - "+event.title);eventElement.find("div.fc-event-title").remove();}trigger("eventAfterRender",event,event,eventElement);}}}function slotSegHtml(event,seg){var html="<";var url=event.url;var skinCss=getSkinCss(event,opt);var skinCssAttr=(skinCss?" style='"+skinCss+"'":"");var classes=["fc-event","fc-event-skin","fc-event-vert"];if(isEventDraggable(event)){classes.push("fc-event-draggable");}if(seg.isStart){classes.push("fc-corner-top");}if(seg.isEnd){classes.push("fc-corner-bottom");}classes=classes.concat(event.className);if(event.source){classes=classes.concat(event.source.className||[]);}if(url){html+="a href='"+htmlEscape(event.url)+"'";}else{html+="div";}html+=" class='"+classes.join(" ")+"'"+" style='position:absolute;z-index:8;top:"+seg.top+"px;left:"+seg.left+"px;"+skinCss+"'"+">"+"<div class='fc-event-inner fc-event-skin'"+skinCssAttr+">"+"<div class='fc-event-head fc-event-skin'"+skinCssAttr+">"+"<div class='fc-event-time'>"+htmlEscape(formatDates(event.start,event.end,opt("timeFormat")))+"</div>"+"</div>"+"<div class='fc-event-content'>"+"<div class='fc-event-title'>"+htmlEscape(event.title)+"</div>"+"</div>"+"<div class='fc-event-bg'></div>"+"</div>";if(seg.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-s'>=</div>";}html+="</"+(url?"a":"div")+">";return html;}function bindDaySeg(event,eventElement,seg){if(isEventDraggable(event)){draggableDayEvent(event,eventElement,seg.isStart);}if(seg.isEnd&&isEventResizable(event)){resizableDayEvent(event,eventElement,seg);}eventElementHandlers(event,eventElement);}function bindSlotSeg(event,eventElement,seg){var timeElement=eventElement.find("div.fc-event-time");if(isEventDraggable(event)){draggableSlotEvent(event,eventElement,timeElement);}if(seg.isEnd&&isEventResizable(event)){resizableSlotEvent(event,eventElement,timeElement);}eventElementHandlers(event,eventElement);}function draggableDayEvent(event,eventElement,isStart){var origWidth;var revert;var allDay=true;var dayDelta;var dis=opt("isRTL")?-1:1;var hoverListener=getHoverListener();var colWidth=getColWidth();var slotHeight=getSlotHeight();var minMinute=getMinMinute();eventElement.draggable({zIndex:9,opacity:opt("dragOpacity","month"),revertDuration:opt("dragRevertDuration"),start:function(ev,ui){trigger("eventDragStart",eventElement,event,ev,ui);hideEvents(event,eventElement);origWidth=eventElement.width();hoverListener.start(function(cell,origCell,rowDelta,colDelta){clearOverlays();if(cell){revert=false;dayDelta=colDelta*dis;if(!cell.row){renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));resetElement();}else{if(isStart){if(allDay){eventElement.width(colWidth-10);setOuterHeight(eventElement,slotHeight*Math.round((event.end?((event.end-event.start)/MINUTE_MS):opt("defaultEventMinutes"))/opt("slotMinutes")));eventElement.draggable("option","grid",[colWidth,1]);allDay=false;}}else{revert=true;}}revert=revert||(allDay&&!dayDelta);}else{resetElement();revert=true;}eventElement.draggable("option","revert",revert);},ev,"drag");},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger("eventDragStop",eventElement,event,ev,ui);if(revert){resetElement();eventElement.css("filter","");showEvents(event,eventElement);}else{var minuteDelta=0;if(!allDay){minuteDelta=Math.round((eventElement.offset().top-getBodyContent().offset().top)/slotHeight)*opt("slotMinutes")+minMinute-(event.start.getHours()*60+event.start.getMinutes());}eventDrop(this,event,dayDelta,minuteDelta,allDay,ev,ui);}}});function resetElement(){if(!allDay){eventElement.width(origWidth).height("").draggable("option","grid",null);allDay=true;}}}function draggableSlotEvent(event,eventElement,timeElement){var origPosition;var allDay=false;var dayDelta;var minuteDelta;var prevMinuteDelta;var dis=opt("isRTL")?-1:1;var hoverListener=getHoverListener();var colCnt=getColCnt();var colWidth=getColWidth();var slotHeight=getSlotHeight();eventElement.draggable({zIndex:9,scroll:false,grid:[colWidth,slotHeight],axis:colCnt==1?"y":false,opacity:opt("dragOpacity"),revertDuration:opt("dragRevertDuration"),start:function(ev,ui){trigger("eventDragStart",eventElement,event,ev,ui);hideEvents(event,eventElement);origPosition=eventElement.position();minuteDelta=prevMinuteDelta=0;hoverListener.start(function(cell,origCell,rowDelta,colDelta){eventElement.draggable("option","revert",!cell);clearOverlays();if(cell){dayDelta=colDelta*dis;if(opt("allDaySlot")&&!cell.row){if(!allDay){allDay=true;timeElement.hide();eventElement.draggable("option","grid",null);}renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));}else{resetElement();}}},ev,"drag");},drag:function(ev,ui){minuteDelta=Math.round((ui.position.top-origPosition.top)/slotHeight)*opt("slotMinutes");if(minuteDelta!=prevMinuteDelta){if(!allDay){updateTimeText(minuteDelta);}prevMinuteDelta=minuteDelta;}},stop:function(ev,ui){var cell=hoverListener.stop();clearOverlays();trigger("eventDragStop",eventElement,event,ev,ui);if(cell&&(dayDelta||minuteDelta||allDay)){eventDrop(this,event,dayDelta,allDay?0:minuteDelta,allDay,ev,ui);}else{resetElement();eventElement.css("filter","");eventElement.css(origPosition);updateTimeText(0);showEvents(event,eventElement);}}});function updateTimeText(minuteDelta){var newStart=addMinutes(cloneDate(event.start),minuteDelta);var newEnd;if(event.end){newEnd=addMinutes(cloneDate(event.end),minuteDelta);}timeElement.text(formatDates(newStart,newEnd,opt("timeFormat")));}function resetElement(){if(allDay){timeElement.css("display","");eventElement.draggable("option","grid",[colWidth,slotHeight]);allDay=false;}}}function resizableSlotEvent(event,eventElement,timeElement){var slotDelta,prevSlotDelta;var slotHeight=getSlotHeight();eventElement.resizable({handles:{s:"div.ui-resizable-s"},grid:slotHeight,start:function(ev,ui){slotDelta=prevSlotDelta=0;hideEvents(event,eventElement);eventElement.css("z-index",9);trigger("eventResizeStart",this,event,ev,ui);},resize:function(ev,ui){slotDelta=Math.round((Math.max(slotHeight,eventElement.height())-ui.originalSize.height)/slotHeight);if(slotDelta!=prevSlotDelta){timeElement.text(formatDates(event.start,(!slotDelta&&!event.end)?null:addMinutes(eventEnd(event),opt("slotMinutes")*slotDelta),opt("timeFormat")));prevSlotDelta=slotDelta;}},stop:function(ev,ui){trigger("eventResizeStop",this,event,ev,ui);if(slotDelta){eventResize(this,event,0,opt("slotMinutes")*slotDelta,ev,ui);}else{eventElement.css("z-index",8);showEvents(event,eventElement);}}});}}function countForwardSegs(levels){var i,j,k,level,segForward,segBack;for(i=levels.length-1;i>0;i--){level=levels[i];for(j=0;j<level.length;j++){segForward=level[j];for(k=0;k<levels[i-1].length;k++){segBack=levels[i-1][k];if(segsCollide(segForward,segBack)){segBack.forward=Math.max(segBack.forward||0,(segForward.forward||0)+1);}}}}}function View(element,calendar,viewName){var t=this;t.element=element;t.calendar=calendar;t.name=viewName;t.opt=opt;t.trigger=trigger;t.isEventDraggable=isEventDraggable;t.isEventResizable=isEventResizable;t.reportEvents=reportEvents;t.eventEnd=eventEnd;t.reportEventElement=reportEventElement;t.reportEventClear=reportEventClear;t.eventElementHandlers=eventElementHandlers;t.showEvents=showEvents;t.hideEvents=hideEvents;t.eventDrop=eventDrop;t.eventResize=eventResize;var defaultEventEnd=t.defaultEventEnd;var normalizeEvent=calendar.normalizeEvent;var reportEventChange=calendar.reportEventChange;var eventsByID={};var eventElements=[];var eventElementsByID={};var options=calendar.options;function opt(name,viewNameOverride){var v=options[name];if(typeof v=="object"){return smartProperty(v,viewNameOverride||viewName);}return v;}function trigger(name,thisObj){return calendar.trigger.apply(calendar,[name,thisObj||t].concat(Array.prototype.slice.call(arguments,2),[t]));}function isEventDraggable(event){return isEventEditable(event)&&!opt("disableDragging");}function isEventResizable(event){return isEventEditable(event)&&!opt("disableResizing");}function isEventEditable(event){return firstDefined(event.editable,(event.source||{}).editable,opt("editable"));}function reportEvents(events){eventsByID={};var i,len=events.length,event;for(i=0;i<len;i++){event=events[i];if(eventsByID[event._id]){eventsByID[event._id].push(event);}else{eventsByID[event._id]=[event];}}}function eventEnd(event){return event.end?cloneDate(event.end):defaultEventEnd(event);}function reportEventElement(event,element){eventElements.push(element);if(eventElementsByID[event._id]){eventElementsByID[event._id].push(element);}else{eventElementsByID[event._id]=[element];}}function reportEventClear(){eventElements=[];eventElementsByID={};}function eventElementHandlers(event,eventElement){eventElement.click(function(ev){if(!eventElement.hasClass("ui-draggable-dragging")&&!eventElement.hasClass("ui-resizable-resizing")){return trigger("eventClick",this,event,ev);}}).hover(function(ev){trigger("eventMouseover",this,event,ev);},function(ev){trigger("eventMouseout",this,event,ev);});}function showEvents(event,exceptElement){eachEventElement(event,exceptElement,"show");}function hideEvents(event,exceptElement){eachEventElement(event,exceptElement,"hide");}function eachEventElement(event,exceptElement,funcName){var elements=eventElementsByID[event._id],i,len=elements.length;for(i=0;i<len;i++){if(!exceptElement||elements[i][0]!=exceptElement[0]){elements[i][funcName]();}}}function eventDrop(e,event,dayDelta,minuteDelta,allDay,ev,ui){var oldAllDay=event.allDay;var eventId=event._id;moveEvents(eventsByID[eventId],dayDelta,minuteDelta,allDay);trigger("eventDrop",e,event,dayDelta,minuteDelta,allDay,function(){moveEvents(eventsByID[eventId],-dayDelta,-minuteDelta,oldAllDay);reportEventChange(eventId);},ev,ui);reportEventChange(eventId);}function eventResize(e,event,dayDelta,minuteDelta,ev,ui){var eventId=event._id;elongateEvents(eventsByID[eventId],dayDelta,minuteDelta);trigger("eventResize",e,event,dayDelta,minuteDelta,function(){elongateEvents(eventsByID[eventId],-dayDelta,-minuteDelta);reportEventChange(eventId);},ev,ui);reportEventChange(eventId);}function moveEvents(events,dayDelta,minuteDelta,allDay){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];if(allDay!==undefined){e.allDay=allDay;}addMinutes(addDays(e.start,dayDelta,true),minuteDelta);if(e.end){e.end=addMinutes(addDays(e.end,dayDelta,true),minuteDelta);}normalizeEvent(e,options);}}function elongateEvents(events,dayDelta,minuteDelta){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];e.end=addMinutes(addDays(eventEnd(e),dayDelta,true),minuteDelta);normalizeEvent(e,options);}}}function DayEventRenderer(){var t=this;t.renderDaySegs=renderDaySegs;t.resizableDayEvent=resizableDayEvent;var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var reportEventElement=t.reportEventElement;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventResize=t.eventResize;var getRowCnt=t.getRowCnt;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var allDayRow=t.allDayRow;var allDayBounds=t.allDayBounds;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var dayOfWeekCol=t.dayOfWeekCol;var dateCell=t.dateCell;var compileDaySegs=t.compileDaySegs;var getDaySegmentContainer=t.getDaySegmentContainer;var bindDaySeg=t.bindDaySeg;var formatDates=t.calendar.formatDates;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var clearSelection=t.clearSelection;function renderDaySegs(segs,modifiedEventId){var segmentContainer=getDaySegmentContainer();var rowDivs;var rowCnt=getRowCnt();var colCnt=getColCnt();var i=0;var rowI;var levelI;var colHeights;var j;var segCnt=segs.length;var seg;var top;var k;segmentContainer[0].innerHTML=daySegHTML(segs);daySegElementResolve(segs,segmentContainer.children());daySegElementReport(segs);daySegHandlers(segs,segmentContainer,modifiedEventId);daySegCalcHSides(segs);daySegSetWidths(segs);daySegCalcHeights(segs);rowDivs=getRowDivs();for(rowI=0;rowI<rowCnt;rowI++){levelI=0;colHeights=[];for(j=0;j<colCnt;j++){colHeights[j]=0;}while(i<segCnt&&(seg=segs[i]).row==rowI){top=arrayMax(colHeights.slice(seg.startCol,seg.endCol));seg.top=top;top+=seg.outerHeight;for(k=seg.startCol;k<seg.endCol;k++){colHeights[k]=top;}i++;}rowDivs[rowI].height(arrayMax(colHeights));}daySegSetTops(segs,getRowTops(rowDivs));}function renderTempDaySegs(segs,adjustRow,adjustTop){var tempContainer=$("<div/>");var elements;var segmentContainer=getDaySegmentContainer();var i;var segCnt=segs.length;var element;tempContainer[0].innerHTML=daySegHTML(segs);elements=tempContainer.children();segmentContainer.append(elements);daySegElementResolve(segs,elements);daySegCalcHSides(segs);daySegSetWidths(segs);daySegCalcHeights(segs);daySegSetTops(segs,getRowTops(getRowDivs()));elements=[];for(i=0;i<segCnt;i++){element=segs[i].element;if(element){if(segs[i].row===adjustRow){element.css("top",adjustTop);}elements.push(element[0]);}}return $(elements);}function daySegHTML(segs){var rtl=opt("isRTL");var i;var segCnt=segs.length;var seg;var event;var url;var classes;var bounds=allDayBounds();var minLeft=bounds.left;var maxLeft=bounds.right;var leftCol;var rightCol;var left;var right;var skinCss;var html="";for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;classes=["fc-event","fc-event-skin","fc-event-hori"];if(isEventDraggable(event)){classes.push("fc-event-draggable");}if(rtl){if(seg.isStart){classes.push("fc-corner-right");}if(seg.isEnd){classes.push("fc-corner-left");}leftCol=dayOfWeekCol(seg.end.getDay()-1);rightCol=dayOfWeekCol(seg.start.getDay());left=seg.isEnd?colContentLeft(leftCol):minLeft;right=seg.isStart?colContentRight(rightCol):maxLeft;}else{if(seg.isStart){classes.push("fc-corner-left");}if(seg.isEnd){classes.push("fc-corner-right");}leftCol=dayOfWeekCol(seg.start.getDay());rightCol=dayOfWeekCol(seg.end.getDay()-1);left=seg.isStart?colContentLeft(leftCol):minLeft;right=seg.isEnd?colContentRight(rightCol):maxLeft;}classes=classes.concat(event.className);if(event.source){classes=classes.concat(event.source.className||[]);}url=event.url;skinCss=getSkinCss(event,opt);if(url){html+="<a href='"+htmlEscape(url)+"'";}else{html+="<div";}html+=" class='"+classes.join(" ")+"'"+" style='position:absolute;z-index:8;left:"+left+"px;"+skinCss+"'"+">"+"<div"+" class='fc-event-inner fc-event-skin'"+(skinCss?" style='"+skinCss+"'":"")+">";if(!event.allDay&&seg.isStart){html+="<span class='fc-event-time'>"+htmlEscape(formatDates(event.start,event.end,opt("timeFormat")))+"</span>";}html+="<span class='fc-event-title'>"+htmlEscape(event.title)+"</span>"+"</div>";if(seg.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-"+(rtl?"w":"e")+"'>"+"&nbsp;&nbsp;&nbsp;"+"</div>";}html+="</"+(url?"a":"div")+">";seg.left=left;seg.outerWidth=right-left;seg.startCol=leftCol;seg.endCol=rightCol+1;}return html;}function daySegElementResolve(segs,elements){var i;var segCnt=segs.length;var seg;var event;var element;var triggerRes;for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;element=$(elements[i]);triggerRes=trigger("eventRender",event,event,element);if(triggerRes===false){element.remove();}else{if(triggerRes&&triggerRes!==true){triggerRes=$(triggerRes).css({position:"absolute",left:seg.left});element.replaceWith(triggerRes);element=triggerRes;}seg.element=element;}}}function daySegElementReport(segs){var i;var segCnt=segs.length;var seg;var element;for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){reportEventElement(seg.event,element);}}}function daySegHandlers(segs,segmentContainer,modifiedEventId){var i;var segCnt=segs.length;var seg;var element;var event;for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){event=seg.event;if(event._id===modifiedEventId){bindDaySeg(event,element,seg);}else{element[0]._fci=i;}}}lazySegBind(segmentContainer,segs,bindDaySeg);}function daySegCalcHSides(segs){var i;var segCnt=segs.length;var seg;var element;var key,val;var hsideCache={};for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){key=seg.key=cssKey(element[0]);val=hsideCache[key];if(val===undefined){val=hsideCache[key]=hsides(element,true);}seg.hsides=val;}}}function daySegSetWidths(segs){var i;var segCnt=segs.length;var seg;var element;for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){element[0].style.width=Math.max(0,seg.outerWidth-seg.hsides)+"px";}}}function daySegCalcHeights(segs){var i;var segCnt=segs.length;var seg;var element;var key,val;var vmarginCache={};for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){key=seg.key;val=vmarginCache[key];if(val===undefined){val=vmarginCache[key]=vmargins(element);}seg.outerHeight=element[0].offsetHeight+val;}}}function getRowDivs(){var i;var rowCnt=getRowCnt();var rowDivs=[];for(i=0;i<rowCnt;i++){rowDivs[i]=allDayRow(i).find("td:first div.fc-day-content > div");}return rowDivs;}function getRowTops(rowDivs){var i;var rowCnt=rowDivs.length;var tops=[];for(i=0;i<rowCnt;i++){tops[i]=rowDivs[i][0].offsetTop;}return tops;}function daySegSetTops(segs,rowTops){var i;var segCnt=segs.length;var seg;var element;var event;for(i=0;i<segCnt;i++){seg=segs[i];element=seg.element;if(element){element[0].style.top=rowTops[seg.row]+(seg.top||0)+"px";event=seg.event;trigger("eventAfterRender",event,event,element);}}}function resizableDayEvent(event,element,seg){var rtl=opt("isRTL");var direction=rtl?"w":"e";var handle=element.find("div.ui-resizable-"+direction);var isResizing=false;disableTextSelection(element);element.mousedown(function(ev){ev.preventDefault();}).click(function(ev){if(isResizing){ev.preventDefault();ev.stopImmediatePropagation();}});handle.mousedown(function(ev){if(ev.which!=1){return;}isResizing=true;var hoverListener=t.getHoverListener();var rowCnt=getRowCnt();var colCnt=getColCnt();var dis=rtl?-1:1;var dit=rtl?colCnt-1:0;var elementTop=element.css("top");var dayDelta;var helpers;var eventCopy=$.extend({},event);var minCell=dateCell(event.start);clearSelection();$("body").css("cursor",direction+"-resize").one("mouseup",mouseup);trigger("eventResizeStart",this,event,ev);hoverListener.start(function(cell,origCell){if(cell){var r=Math.max(minCell.row,cell.row);var c=cell.col;if(rowCnt==1){r=0;}if(r==minCell.row){if(rtl){c=Math.min(minCell.col,c);}else{c=Math.max(minCell.col,c);}}dayDelta=(r*7+c*dis+dit)-(origCell.row*7+origCell.col*dis+dit);var newEnd=addDays(eventEnd(event),dayDelta,true);if(dayDelta){eventCopy.end=newEnd;var oldHelpers=helpers;helpers=renderTempDaySegs(compileDaySegs([eventCopy]),seg.row,elementTop);helpers.find("*").css("cursor",direction+"-resize");if(oldHelpers){oldHelpers.remove();}hideEvents(event);}else{if(helpers){showEvents(event);helpers.remove();helpers=null;}}clearOverlays();renderDayOverlay(event.start,addDays(cloneDate(newEnd),1));}},ev);function mouseup(ev){trigger("eventResizeStop",this,event,ev);$("body").css("cursor","");hoverListener.stop();clearOverlays();if(dayDelta){eventResize(this,event,dayDelta,0,ev);}setTimeout(function(){isResizing=false;},0);}});}}function SelectionManager(){var t=this;t.select=select;t.unselect=unselect;t.reportSelection=reportSelection;t.daySelectionMousedown=daySelectionMousedown;var opt=t.opt;var trigger=t.trigger;var defaultSelectionEnd=t.defaultSelectionEnd;var renderSelection=t.renderSelection;var clearSelection=t.clearSelection;var selected=false;if(opt("selectable")&&opt("unselectAuto")){$(document).mousedown(function(ev){var ignore=opt("unselectCancel");if(ignore){if($(ev.target).parents(ignore).length){return;}}unselect(ev);});}function select(startDate,endDate,allDay){unselect();if(!endDate){endDate=defaultSelectionEnd(startDate,allDay);}renderSelection(startDate,endDate,allDay);reportSelection(startDate,endDate,allDay);}function unselect(ev){if(selected){selected=false;clearSelection();trigger("unselect",null,ev);}}function reportSelection(startDate,endDate,allDay,ev){selected=true;trigger("select",null,startDate,endDate,allDay,ev);}function daySelectionMousedown(ev){var cellDate=t.cellDate;var cellIsAllDay=t.cellIsAllDay;var hoverListener=t.getHoverListener();var reportDayClick=t.reportDayClick;if(ev.which==1&&opt("selectable")){unselect(ev);var _mousedownElement=this;var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&cellIsAllDay(cell)){dates=[cellDate(origCell),cellDate(cell)].sort(cmp);renderSelection(dates[0],dates[1],true);}else{dates=null;}},ev);$(document).one("mouseup",function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],true,ev);}reportSelection(dates[0],dates[1],true,ev);}});}}}function OverlayManager(){var t=this;t.renderOverlay=renderOverlay;t.clearOverlays=clearOverlays;var usedOverlays=[];var unusedOverlays=[];function renderOverlay(rect,parent){var e=unusedOverlays.shift();if(!e){e=$("<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>");}if(e[0].parentNode!=parent[0]){e.appendTo(parent);}usedOverlays.push(e.css(rect).show());return e;}function clearOverlays(){var e;while(e=usedOverlays.shift()){unusedOverlays.push(e.hide().unbind());}}}function CoordinateGrid(buildFunc){var t=this;var rows;var cols;t.build=function(){rows=[];cols=[];buildFunc(rows,cols);};t.cell=function(x,y){var rowCnt=rows.length;var colCnt=cols.length;var i,r=-1,c=-1;for(i=0;i<rowCnt;i++){if(y>=rows[i][0]&&y<rows[i][1]){r=i;break;}}for(i=0;i<colCnt;i++){if(x>=cols[i][0]&&x<cols[i][1]){c=i;break;}}return(r>=0&&c>=0)?{row:r,col:c}:null;};t.rect=function(row0,col0,row1,col1,originElement){var origin=originElement.offset();return{top:rows[row0][0]-origin.top,left:cols[col0][0]-origin.left,width:cols[col1][1]-cols[col0][0],height:rows[row1][1]-rows[row0][0]};};}function HoverListener(coordinateGrid){var t=this;var bindType;var change;var firstCell;var cell;t.start=function(_change,ev,_bindType){change=_change;firstCell=cell=null;coordinateGrid.build();mouse(ev);bindType=_bindType||"mousemove";$(document).bind(bindType,mouse);};function mouse(ev){_fixUIEvent(ev);var newCell=coordinateGrid.cell(ev.pageX,ev.pageY);if(!newCell!=!cell||newCell&&(newCell.row!=cell.row||newCell.col!=cell.col)){if(newCell){if(!firstCell){firstCell=newCell;}change(newCell,firstCell,newCell.row-firstCell.row,newCell.col-firstCell.col);}else{change(newCell,firstCell);}cell=newCell;}}t.stop=function(){$(document).unbind(bindType,mouse);return cell;};}function _fixUIEvent(event){if(event.pageX===undefined){event.pageX=event.originalEvent.pageX;event.pageY=event.originalEvent.pageY;}}function HorizontalPositionCache(getElement){var t=this,elements={},lefts={},rights={};function e(i){return elements[i]=elements[i]||getElement(i);}t.left=function(i){return lefts[i]=lefts[i]===undefined?e(i).position().left:lefts[i];};t.right=function(i){return rights[i]=rights[i]===undefined?t.left(i)+e(i).width():rights[i];};t.clear=function(){elements={};lefts={};rights={};};}})(jQuery);

/*!
 * jQuery Tools v1.2.7 - The missing UI library for the Web
 * 
 * tooltip/tooltip.js
 * 
 * NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.
 * 
 * http://flowplayer.org/tools/
 * 
 */
(function(a){a.tools=a.tools||{version:"v1.2.7"},a.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0,delay:30,opacity:1,tip:0,fadeIE:!1,position:["top","center"],offset:[0,0],relative:!1,cancelDefault:!0,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(a,c,d){b[a]=[c,d]}};var b={toggle:[function(a){var b=this.getConf(),c=this.getTip(),d=b.opacity;d<1&&c.css({opacity:d}),c.show(),a.call()},function(a){this.getTip().hide(),a.call()}],fade:[function(b){var c=this.getConf();!a.browser.msie||c.fadeIE?this.getTip().fadeTo(c.fadeInSpeed,c.opacity,b):(this.getTip().show(),b())},function(b){var c=this.getConf();!a.browser.msie||c.fadeIE?this.getTip().fadeOut(c.fadeOutSpeed,b):(this.getTip().hide(),b())}]};function c(b,c,d){var e=d.relative?b.position().top:b.offset().top,f=d.relative?b.position().left:b.offset().left,g=d.position[0];e-=c.outerHeight()-d.offset[0],f+=b.outerWidth()+d.offset[1],/iPad/i.test(navigator.userAgent)&&(e-=a(window).scrollTop());var h=c.outerHeight()+b.outerHeight();g=="center"&&(e+=h/2),g=="bottom"&&(e+=h),g=d.position[1];var i=c.outerWidth()+b.outerWidth();g=="center"&&(f-=i/2),g=="left"&&(f-=i);return{top:e,left:f}}function d(d,e){var f=this,g=d.add(f),h,i=0,j=0,k=d.attr("title"),l=d.attr("data-tooltip"),m=b[e.effect],n,o=d.is(":input"),p=o&&d.is(":checkbox, :radio, select, :button, :submit"),q=d.attr("type"),r=e.events[q]||e.events[o?p?"widget":"input":"def"];if(!m)throw"Nonexistent effect \""+e.effect+"\"";r=r.split(/,\s*/);if(r.length!=2)throw"Tooltip: bad events configuration for "+q;d.on(r[0],function(a){clearTimeout(i),e.predelay?j=setTimeout(function(){f.show(a)},e.predelay):f.show(a)}).on(r[1],function(a){clearTimeout(j),e.delay?i=setTimeout(function(){f.hide(a)},e.delay):f.hide(a)}),k&&e.cancelDefault&&(d.removeAttr("title"),d.data("title",k)),a.extend(f,{show:function(b){if(!h){l?h=a(l):e.tip?h=a(e.tip).eq(0):k?h=a(e.layout).addClass(e.tipClass).appendTo(document.body).hide().append(k):(h=d.next(),h.length||(h=d.parent().next()));if(!h.length)throw"Cannot find tooltip for "+d}if(f.isShown())return f;h.stop(!0,!0);var o=c(d,h,e);e.tip&&h.html(d.data("title")),b=a.Event(),b.type="onBeforeShow",g.trigger(b,[o]);if(b.isDefaultPrevented())return f;o=c(d,h,e),h.css({position:"absolute",top:o.top,left:o.left}),n=!0,m[0].call(f,function(){b.type="onShow",n="full",g.trigger(b)});var p=e.events.tooltip.split(/,\s*/);h.data("__set")||(h.off(p[0]).on(p[0],function(){clearTimeout(i),clearTimeout(j)}),p[1]&&!d.is("input:not(:checkbox, :radio), textarea")&&h.off(p[1]).on(p[1],function(a){a.relatedTarget!=d[0]&&d.trigger(r[1].split(" ")[0])}),e.tip||h.data("__set",!0));return f},hide:function(c){if(!h||!f.isShown())return f;c=a.Event(),c.type="onBeforeHide",g.trigger(c);if(!c.isDefaultPrevented()){n=!1,b[e.effect][1].call(f,function(){c.type="onHide",g.trigger(c)});return f}},isShown:function(a){return a?n=="full":n},getConf:function(){return e},getTip:function(){return h},getTrigger:function(){return d}}),a.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(b,c){a.isFunction(e[c])&&a(f).on(c,e[c]),f[c]=function(b){b&&a(f).on(c,b);return f}})}a.fn.tooltip=function(b){var c=this.data("tooltip");if(c)return c;b=a.extend(!0,{},a.tools.tooltip.conf,b),typeof b.position=="string"&&(b.position=b.position.split(/,?\s/)),this.each(function(){c=new d(a(this),b),a(this).data("tooltip",c)});return b.api?c:this}})(jQuery);

/*!
 * jQuery Form Plugin
 * version: 3.18 (28-SEP-2012)
 * @requires jQuery v1.5 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses:
 *    http://malsup.github.com/mit-license.txt
 *    http://malsup.github.com/gpl-license-v2.txt
 */
(function(e){var c={};c.fileapi=e("<input type='file'/>").get(0).files!==undefined;c.formdata=window.FormData!==undefined;e.fn.ajaxSubmit=function(h){if(!this.length){d("ajaxSubmit: skipping submit process - no element selected");return this;}var g,y,j,m=this;if(typeof h=="function"){h={success:h};}g=this.attr("method");y=this.attr("action");j=(typeof y==="string")?e.trim(y):"";j=j||window.location.href||"";if(j){j=(j.match(/^([^#]+)/)||[])[1];}h=e.extend(true,{url:j,success:e.ajaxSettings.success,type:g||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},h);var s={};this.trigger("form-pre-serialize",[this,h,s]);if(s.veto){d("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this;}if(h.beforeSerialize&&h.beforeSerialize(this,h)===false){d("ajaxSubmit: submit aborted via beforeSerialize callback");return this;}var l=h.traditional;if(l===undefined){l=e.ajaxSettings.traditional;}var p=[];var B,C=this.formToArray(h.semantic,p);if(h.data){h.extraData=h.data;B=e.param(h.data,l);}if(h.beforeSubmit&&h.beforeSubmit(C,this,h)===false){d("ajaxSubmit: submit aborted via beforeSubmit callback");return this;}this.trigger("form-submit-validate",[C,this,h,s]);if(s.veto){d("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this;}var w=e.param(C,l);if(B){w=(w?(w+"&"+B):B);}if(h.type.toUpperCase()=="GET"){h.url+=(h.url.indexOf("?")>=0?"&":"?")+w;h.data=null;}else{h.data=w;}var E=[];if(h.resetForm){E.push(function(){m.resetForm();});}if(h.clearForm){E.push(function(){m.clearForm(h.includeHidden);});}if(!h.dataType&&h.target){var i=h.success||function(){};E.push(function(q){var k=h.replaceTarget?"replaceWith":"html";e(h.target)[k](q).each(i,arguments);});}else{if(h.success){E.push(h.success);}}h.success=function(H,q,I){var G=h.context||this;for(var F=0,k=E.length;F<k;F++){E[F].apply(G,[H,q,I||m,m]);}};var A=e("input:file:enabled[value]",this);var n=A.length>0;var z="multipart/form-data";var v=(m.attr("enctype")==z||m.attr("encoding")==z);var u=c.fileapi&&c.formdata;d("fileAPI :"+u);var o=(n||v)&&!u;var t;if(h.iframe!==false&&(h.iframe||o)){if(h.closeKeepAlive){e.get(h.closeKeepAlive,function(){t=D(C);});}else{t=D(C);}}else{if((n||v)&&u){t=r(C);}else{t=e.ajax(h);}}m.removeData("jqxhr").data("jqxhr",t);for(var x=0;x<p.length;x++){p[x]=null;}this.trigger("form-submit-notify",[this,h]);return this;function f(H){var I=e.param(H).split("&");var q=I.length;var k={};var G,F;for(G=0;G<q;G++){F=I[G].split("=");k[decodeURIComponent(F[0])]=decodeURIComponent(F[1]);}return k;}function r(q){var k=new FormData();for(var F=0;F<q.length;F++){k.append(q[F].name,q[F].value);}if(h.extraData){var I=f(h.extraData);for(var J in I){if(I.hasOwnProperty(J)){k.append(J,I[J]);}}}h.data=null;var H=e.extend(true,{},e.ajaxSettings,h,{contentType:false,processData:false,cache:false,type:g||"POST"});if(h.uploadProgress){H.xhr=function(){var K=jQuery.ajaxSettings.xhr();if(K.upload){K.upload.onprogress=function(O){var N=0;var L=O.loaded||O.position;var M=O.total;if(O.lengthComputable){N=Math.ceil(L/M*100);}h.uploadProgress(O,L,M,N);};}return K;};}H.data=null;var G=H.beforeSend;H.beforeSend=function(L,K){K.data=k;if(G){G.call(this,L,K);}};return e.ajax(H);}function D(ad){var I=m[0],H,Z,T,ab,W,K,O,M,N,X,aa,R;var L=!!e.fn.prop;var ag=e.Deferred();if(e(":input[name=submit],:input[id=submit]",I).length){alert('Error: Form elements must not have name or id of "submit".');ag.reject();return ag;}if(ad){for(Z=0;Z<p.length;Z++){H=e(p[Z]);if(L){H.prop("disabled",false);}else{H.removeAttr("disabled");}}}T=e.extend(true,{},e.ajaxSettings,h);T.context=T.context||T;W="jqFormIO"+(new Date().getTime());if(T.iframeTarget){K=e(T.iframeTarget);X=K.attr("name");if(!X){K.attr("name",W);}else{W=X;}}else{K=e('<iframe name="'+W+'" src="'+T.iframeSrc+'" />');K.css({position:"absolute",top:"-1000px",left:"-1000px"});}O=K[0];M={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(ah){var ai=(ah==="timeout"?"timeout":"aborted");d("aborting upload... "+ai);this.aborted=1;if(O.contentWindow.document.execCommand){try{O.contentWindow.document.execCommand("Stop");}catch(aj){}}K.attr("src",T.iframeSrc);M.error=ai;if(T.error){T.error.call(T.context,M,ai,ah);}if(ab){e.event.trigger("ajaxError",[M,T,ai]);}if(T.complete){T.complete.call(T.context,M,ai);}}};ab=T.global;if(ab&&0===e.active++){e.event.trigger("ajaxStart");}if(ab){e.event.trigger("ajaxSend",[M,T]);}if(T.beforeSend&&T.beforeSend.call(T.context,M,T)===false){if(T.global){e.active--;}ag.reject();return ag;}if(M.aborted){ag.reject();return ag;}N=I.clk;if(N){X=N.name;if(X&&!N.disabled){T.extraData=T.extraData||{};T.extraData[X]=N.value;if(N.type=="image"){T.extraData[X+".x"]=I.clk_x;T.extraData[X+".y"]=I.clk_y;}}}var S=1;var P=2;function Q(ai){var ah=ai.contentWindow?ai.contentWindow.document:ai.contentDocument?ai.contentDocument:ai.document;return ah;}var G=e("meta[name=csrf-token]").attr("content");var F=e("meta[name=csrf-param]").attr("content");if(F&&G){T.extraData=T.extraData||{};T.extraData[F]=G;}function Y(){var aj=m.attr("target"),ah=m.attr("action");I.setAttribute("target",W);if(!g){I.setAttribute("method","POST");}if(ah!=T.url){I.setAttribute("action",T.url);}if(!T.skipEncodingOverride&&(!g||/post/i.test(g))){m.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});}if(T.timeout){R=setTimeout(function(){aa=true;V(S);},T.timeout);}function ak(){try{var am=Q(O).readyState;d("state = "+am);if(am&&am.toLowerCase()=="uninitialized"){setTimeout(ak,50);}}catch(an){d("Server abort: ",an," (",an.name,")");V(P);if(R){clearTimeout(R);}R=undefined;}}var ai=[];try{if(T.extraData){for(var al in T.extraData){if(T.extraData.hasOwnProperty(al)){if(e.isPlainObject(T.extraData[al])&&T.extraData[al].hasOwnProperty("name")&&T.extraData[al].hasOwnProperty("value")){ai.push(e('<input type="hidden" name="'+T.extraData[al].name+'">').attr("value",T.extraData[al].value).appendTo(I)[0]);}else{ai.push(e('<input type="hidden" name="'+al+'">').attr("value",T.extraData[al]).appendTo(I)[0]);}}}}if(!T.iframeTarget){K.appendTo("body");if(O.attachEvent){O.attachEvent("onload",V);}else{O.addEventListener("load",V,false);}}setTimeout(ak,15);I.submit();}finally{I.setAttribute("action",ah);if(aj){I.setAttribute("target",aj);}else{m.removeAttr("target");}e(ai).remove();}}if(T.forceSync){Y();}else{setTimeout(Y,10);}var ae,af,ac=50,J;function V(am){if(M.aborted||J){return;}try{af=Q(O);}catch(ap){d("cannot access response document: ",ap);am=P;}if(am===S&&M){M.abort("timeout");ag.reject(M,"timeout");return;}else{if(am==P&&M){M.abort("server abort");ag.reject(M,"error","server abort");return;}}if(!af||af.location.href==T.iframeSrc){if(!aa){return;}}if(O.detachEvent){O.detachEvent("onload",V);}else{O.removeEventListener("load",V,false);}var ak="success",ao;try{if(aa){throw"timeout";}var aj=T.dataType=="xml"||af.XMLDocument||e.isXMLDoc(af);d("isXml="+aj);if(!aj&&window.opera&&(af.body===null||!af.body.innerHTML)){if(--ac){d("requeing onLoad callback, DOM not available");setTimeout(V,250);return;}}var aq=af.body?af.body:af.documentElement;M.responseText=aq?aq.innerHTML:null;M.responseXML=af.XMLDocument?af.XMLDocument:af;if(aj){T.dataType="xml";}M.getResponseHeader=function(au){var at={"content-type":T.dataType};return at[au];};if(aq){M.status=Number(aq.getAttribute("status"))||M.status;M.statusText=aq.getAttribute("statusText")||M.statusText;}var ah=(T.dataType||"").toLowerCase();var an=/(json|script|text)/.test(ah);if(an||T.textarea){var al=af.getElementsByTagName("textarea")[0];if(al){M.responseText=al.value;M.status=Number(al.getAttribute("status"))||M.status;M.statusText=al.getAttribute("statusText")||M.statusText;}else{if(an){var ai=af.getElementsByTagName("pre")[0];var ar=af.getElementsByTagName("body")[0];if(ai){M.responseText=ai.textContent?ai.textContent:ai.innerText;}else{if(ar){M.responseText=ar.textContent?ar.textContent:ar.innerText;}}}}}else{if(ah=="xml"&&!M.responseXML&&M.responseText){M.responseXML=U(M.responseText);}}try{ae=k(M,ah,T);}catch(am){ak="parsererror";M.error=ao=(am||ak);}}catch(am){d("error caught: ",am);ak="error";M.error=ao=(am||ak);}if(M.aborted){d("upload aborted");ak=null;}if(M.status){ak=(M.status>=200&&M.status<300||M.status===304)?"success":"error";}if(ak==="success"){if(T.success){T.success.call(T.context,ae,"success",M);}ag.resolve(M.responseText,"success",M);if(ab){e.event.trigger("ajaxSuccess",[M,T]);}}else{if(ak){if(ao===undefined){ao=M.statusText;}if(T.error){T.error.call(T.context,M,ak,ao);}ag.reject(M,"error",ao);if(ab){e.event.trigger("ajaxError",[M,T,ao]);}}}if(ab){e.event.trigger("ajaxComplete",[M,T]);}if(ab&&!--e.active){e.event.trigger("ajaxStop");}if(T.complete){T.complete.call(T.context,M,ak);}J=true;if(T.timeout){clearTimeout(R);}setTimeout(function(){if(!T.iframeTarget){K.remove();}M.responseXML=null;},100);}var U=e.parseXML||function(ah,ai){if(window.ActiveXObject){ai=new ActiveXObject("Microsoft.XMLDOM");ai.async="false";ai.loadXML(ah);}else{ai=(new DOMParser()).parseFromString(ah,"text/xml");}return(ai&&ai.documentElement&&ai.documentElement.nodeName!="parsererror")?ai:null;};var q=e.parseJSON||function(ah){return window["eval"]("("+ah+")");};var k=function(am,ak,aj){var ai=am.getResponseHeader("content-type")||"",ah=ak==="xml"||!ak&&ai.indexOf("xml")>=0,al=ah?am.responseXML:am.responseText;if(ah&&al.documentElement.nodeName==="parsererror"){if(e.error){e.error("parsererror");}}if(aj&&aj.dataFilter){al=aj.dataFilter(al,ak);}if(typeof al==="string"){if(ak==="json"||!ak&&ai.indexOf("json")>=0){al=q(al);}else{if(ak==="script"||!ak&&ai.indexOf("javascript")>=0){e.globalEval(al);}}}return al;};return ag;}};e.fn.ajaxForm=function(f){f=f||{};f.delegation=f.delegation&&e.isFunction(e.fn.on);if(!f.delegation&&this.length===0){var g={s:this.selector,c:this.context};if(!e.isReady&&g.s){d("DOM not ready, queuing ajaxForm");e(function(){e(g.s,g.c).ajaxForm(f);});return this;}d("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)"));return this;}if(f.delegation){e(document).off("submit.form-plugin",this.selector,b).off("click.form-plugin",this.selector,a).on("submit.form-plugin",this.selector,f,b).on("click.form-plugin",this.selector,f,a);return this;}return this.ajaxFormUnbind().bind("submit.form-plugin",f,b).bind("click.form-plugin",f,a);};function b(g){var f=g.data;if(!g.isDefaultPrevented()){g.preventDefault();e(this).ajaxSubmit(f);}}function a(j){var i=j.target;var g=e(i);if(!(g.is(":submit,input:image"))){var f=g.closest(":submit");if(f.length===0){return;}i=f[0];}var h=this;h.clk=i;if(i.type=="image"){if(j.offsetX!==undefined){h.clk_x=j.offsetX;h.clk_y=j.offsetY;}else{if(typeof e.fn.offset=="function"){var k=g.offset();h.clk_x=j.pageX-k.left;h.clk_y=j.pageY-k.top;}else{h.clk_x=j.pageX-i.offsetLeft;h.clk_y=j.pageY-i.offsetTop;}}}setTimeout(function(){h.clk=h.clk_x=h.clk_y=null;},100);}e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin");};e.fn.formToArray=function(w,f){var u=[];if(this.length===0){return u;}var k=this[0];var o=w?k.getElementsByTagName("*"):k.elements;if(!o){return u;}var q,p,m,x,l,s,h;for(q=0,s=o.length;q<s;q++){l=o[q];m=l.name;if(!m){continue;}if(w&&k.clk&&l.type=="image"){if(!l.disabled&&k.clk==l){u.push({name:m,value:e(l).val(),type:l.type});u.push({name:m+".x",value:k.clk_x},{name:m+".y",value:k.clk_y});}continue;}x=e.fieldValue(l,true);if(x&&x.constructor==Array){if(f){f.push(l);}for(p=0,h=x.length;p<h;p++){u.push({name:m,value:x[p]});}}else{if(c.fileapi&&l.type=="file"&&!l.disabled){if(f){f.push(l);}var g=l.files;if(g.length){for(p=0;p<g.length;p++){u.push({name:m,value:g[p],type:l.type});}}else{u.push({name:m,value:"",type:l.type});}}else{if(x!==null&&typeof x!="undefined"){if(f){f.push(l);}u.push({name:m,value:x,type:l.type,required:l.required});}}}}if(!w&&k.clk){var r=e(k.clk),t=r[0];m=t.name;if(m&&!t.disabled&&t.type=="image"){u.push({name:m,value:r.val()});u.push({name:m+".x",value:k.clk_x},{name:m+".y",value:k.clk_y});}}return u;};e.fn.formSerialize=function(f){return e.param(this.formToArray(f));};e.fn.fieldSerialize=function(g){var f=[];this.each(function(){var l=this.name;if(!l){return;}var j=e.fieldValue(this,g);if(j&&j.constructor==Array){for(var k=0,h=j.length;k<h;k++){f.push({name:l,value:j[k]});}}else{if(j!==null&&typeof j!="undefined"){f.push({name:this.name,value:j});}}});return e.param(f);};e.fn.fieldValue=function(l){for(var k=[],h=0,f=this.length;h<f;h++){var j=this[h];var g=e.fieldValue(j,l);if(g===null||typeof g=="undefined"||(g.constructor==Array&&!g.length)){continue;}if(g.constructor==Array){e.merge(k,g);}else{k.push(g);}}return k;};e.fieldValue=function(f,m){var h=f.name,s=f.type,u=f.tagName.toLowerCase();if(m===undefined){m=true;}if(m&&(!h||f.disabled||s=="reset"||s=="button"||(s=="checkbox"||s=="radio")&&!f.checked||(s=="submit"||s=="image")&&f.form&&f.form.clk!=f||u=="select"&&f.selectedIndex==-1)){return null;}if(u=="select"){var o=f.selectedIndex;if(o<0){return null;}var q=[],g=f.options;var k=(s=="select-one");var p=(k?o+1:g.length);for(var j=(k?o:0);j<p;j++){var l=g[j];if(l.selected){var r=l.value;if(!r){r=(l.attributes&&l.attributes.value&&!(l.attributes.value.specified))?l.text:l.value;}if(k){return r;}q.push(r);}}return q;}return e(f).val();};e.fn.clearForm=function(f){return this.each(function(){e("input,select,textarea",this).clearFields(f);});};e.fn.clearFields=e.fn.clearInputs=function(f){var g=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var i=this.type,h=this.tagName.toLowerCase();if(g.test(i)||h=="textarea"){this.value="";}else{if(i=="checkbox"||i=="radio"){this.checked=false;}else{if(h=="select"){this.selectedIndex=-1;}else{if(f){if((f===true&&/hidden/.test(i))||(typeof f=="string"&&e(this).is(f))){this.value="";}}}}}});};e.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset();}});};e.fn.enable=function(f){if(f===undefined){f=true;}return this.each(function(){this.disabled=!f;});};e.fn.selected=function(f){if(f===undefined){f=true;}return this.each(function(){var g=this.type;if(g=="checkbox"||g=="radio"){this.checked=f;}else{if(this.tagName.toLowerCase()=="option"){var h=e(this).parent("select");if(f&&h[0]&&h[0].type=="select-one"){h.find("option").selected(false);}this.selected=f;}}});};e.fn.ajaxSubmit.debug=false;function d(){if(!e.fn.ajaxSubmit.debug){return;}var f="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log){window.console.log(f);}else{if(window.opera&&window.opera.postError){window.opera.postError(f);}}}})(jQuery);
